<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>NIGHTFALL - A Collage Noir</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Special+Elite&family=Playfair+Display:wght@700;900&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: #0a0908;
            overflow: hidden;
            font-family: 'Special Elite', monospace;
            width: 100vw;
            height: 100vh;
            touch-action: none;
            cursor: crosshair;
        }

        #game {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        /* =============================================
           GILLIAM ANIMATION SYSTEM
        ============================================= */
        @keyframes g-idle {
            0%, 100% { transform: rotate(0deg) translateY(0); }
            15% { transform: rotate(0.6deg) translateY(-2px); }
            40% { transform: rotate(-0.4deg) translateY(0); }
            65% { transform: rotate(-0.7deg) translateY(1px); }
            80% { transform: rotate(0.3deg) translateY(-1px); }
        }
        @keyframes g-walk {
            0%, 100% { transform: rotate(-2deg) translateY(0); }
            25% { transform: rotate(2deg) translateY(-5px); }
            50% { transform: rotate(-2deg) translateY(0); }
            75% { transform: rotate(2deg) translateY(-5px); }
        }
        @keyframes g-talk {
            0%, 100% { transform: rotate(0) scale(1); }
            15% { transform: rotate(-1.5deg) scale(1.02); }
            35% { transform: rotate(1.5deg) scale(0.98); }
            55% { transform: rotate(-1deg) scale(1.01); }
            75% { transform: rotate(1deg) scale(0.99); }
        }
        @keyframes neon-buzz {
            0%, 18%, 22%, 25%, 53%, 57%, 100% { opacity: 1; }
            20%, 24%, 55% { opacity: 0.4; }
        }
        @keyframes smoke {
            0% { transform: translateY(0) scale(1) rotate(0); opacity: 0.5; }
            50% { transform: translateY(-40px) scale(1.5) rotate(20deg); opacity: 0.25; }
            100% { transform: translateY(-80px) scale(2.5) rotate(40deg); opacity: 0; }
        }
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-4px) rotate(0.5deg); }
        }
        @keyframes pulse { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }

        /* =============================================
           COLLAGE IMAGE CUTOUTS
           Real photographs styled as paper cutouts
        ============================================= */
        .photo-cutout {
            position: absolute;
            overflow: hidden;
            filter: grayscale(60%) contrast(1.3) sepia(30%);
            transition: filter 0.3s;
        }

        .photo-cutout img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .photo-cutout.torn {
            box-shadow:
                3px 3px 0 rgba(0,0,0,0.6),
                -1px -1px 0 rgba(200,190,170,0.15);
        }

        .photo-cutout.framed {
            border: 6px solid #f0e8d8;
            box-shadow: 4px 4px 12px rgba(0,0,0,0.6);
        }

        .photo-cutout.rough {
            box-shadow:
                2px 3px 0 rgba(0,0,0,0.5),
                -2px -1px 0 rgba(0,0,0,0.3);
        }

        /* =============================================
           SCENE CONTAINER
        ============================================= */
        .scene {
            position: absolute;
            width: 100%;
            height: 100%;
            display: none;
        }
        .scene.active { display: block; }

        /* =============================================
           STREET SCENE
        ============================================= */
        #scene-street {
            background: linear-gradient(170deg, #060810 0%, #0c0e18 40%, #10121c 100%);
        }

        /* Real photo: 52nd Street NYC 1948 - William P. Gottlieb (LOC) */
        .street-photo-bg {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 75%;
            overflow: hidden;
            opacity: 0.35;
            filter: grayscale(70%) contrast(1.4) brightness(0.6);
        }

        .street-photo-bg img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center 30%;
        }

        /* Dark overlay to create depth */
        .street-overlay {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(to bottom,
                rgba(6,8,16,0.3) 0%,
                rgba(6,8,16,0.1) 30%,
                rgba(6,8,16,0.4) 60%,
                rgba(6,8,16,0.95) 80%,
                #0a0c14 100%);
        }

        /* Moon cutout - like snipped from astronomy textbook */
        .moon-cutout {
            position: absolute;
            top: 5%; right: 15%;
            width: 70px; height: 70px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #fff8e0 0%, #e8dcc0 50%, #c0b090 80%, transparent 100%);
            box-shadow: 0 0 60px rgba(255,250,200,0.3), 0 0 120px rgba(255,250,200,0.1);
            animation: float 10s ease-in-out infinite;
        }

        /* Building silhouettes - cut from magazine */
        .building-cutout {
            position: absolute;
            bottom: 20%;
            background: #08080e;
            animation: g-idle 8s ease-in-out infinite;
        }

        .bldg-1 { left: 2%; width: 22%; height: 50%; clip-path: polygon(0 100%, 0 30%, 10% 30%, 10% 15%, 35% 15%, 35% 25%, 60% 25%, 60% 0%, 80% 0%, 80% 20%, 100% 20%, 100% 100%); }
        .bldg-2 { left: 24%; width: 20%; height: 55%; clip-path: polygon(0 100%, 0 40%, 20% 40%, 20% 10%, 40% 10%, 40% 0%, 60% 0%, 60% 10%, 80% 10%, 80% 35%, 100% 35%, 100% 100%); animation-delay: -3s; }
        .bldg-3 { left: 44%; width: 25%; height: 60%; clip-path: polygon(0 100%, 0 35%, 15% 35%, 15% 10%, 30% 10%, 30% 0%, 50% 0%, 50% 5%, 65% 5%, 65% 15%, 85% 15%, 85% 30%, 100% 30%, 100% 100%); animation-delay: -5s; }
        .bldg-4 { left: 69%; width: 32%; height: 45%; clip-path: polygon(0 100%, 0 40%, 15% 40%, 15% 20%, 35% 20%, 35% 10%, 55% 10%, 55% 25%, 75% 25%, 75% 15%, 100% 15%, 100% 100%); animation-delay: -1s; }

        /* Lit windows in buildings */
        .win { position: absolute; background: rgba(255,220,140,0.7); box-shadow: 0 0 6px rgba(255,200,100,0.4); }

        /* Neon signs - hand-painted lettering style */
        .neon {
            position: absolute;
            font-family: sans-serif;
            font-weight: bold;
            animation: neon-buzz 3s ease-in-out infinite;
            z-index: 10;
            cursor: pointer;
        }

        .neon-bar {
            top: 28%; left: 10%;
            font-size: clamp(18px, 4vw, 28px);
            color: #ff3030;
            text-shadow: 0 0 8px #ff3030, 0 0 20px #ff3030, 0 0 40px #ff0000;
        }

        .neon-hotel {
            top: 18%; left: 56%;
            font-size: clamp(14px, 3vw, 22px);
            color: #3388ff;
            text-shadow: 0 0 8px #3388ff, 0 0 20px #3388ff, 0 0 40px #2266dd;
            animation-delay: -1.5s;
        }

        .neon-eats {
            top: 32%; right: 8%;
            font-size: clamp(12px, 2.5vw, 18px);
            color: #ffaa33;
            text-shadow: 0 0 8px #ffaa33, 0 0 16px #ff8811;
            font-family: cursive;
            animation-delay: -2.5s;
        }

        .neon-office {
            top: 22%; left: 34%;
            font-size: clamp(6px, 1.5vw, 10px);
            color: #c0a878;
            text-shadow: 0 0 4px rgba(200,170,120,0.5);
            letter-spacing: 2px;
            font-family: 'Special Elite', monospace;
        }

        /* Street ground */
        .street-ground {
            position: absolute;
            bottom: 0; left: 0;
            width: 100%; height: 22%;
            background: linear-gradient(to bottom, #1a1a1e 0%, #0c0c10 100%);
        }

        .sidewalk {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 20%;
            background: #222228;
        }

        /* Wet reflections */
        .wet-reflect {
            position: absolute;
            bottom: 0;
            height: 15%;
            filter: blur(2px);
            opacity: 0.6;
        }
        .wet-r1 { left: 10%; width: 50px; background: linear-gradient(to bottom, rgba(255,50,50,0.15), transparent); }
        .wet-r2 { left: 55%; width: 40px; background: linear-gradient(to bottom, rgba(50,100,255,0.12), transparent); }
        .wet-r3 { right: 10%; width: 35px; background: linear-gradient(to bottom, rgba(255,170,50,0.1), transparent); }

        /* Streetlamp cutout */
        .streetlamp {
            position: absolute;
            bottom: 20%;
            z-index: 8;
        }
        .lamp-pole { width: 5px; height: 130px; background: linear-gradient(to right, #111, #222, #111); margin: 0 auto; }
        .lamp-fixture { width: 30px; height: 20px; background: #111; border-radius: 4px 4px 0 0; margin: 0 auto; }
        .lamp-glow {
            position: absolute;
            top: -80px; left: 50%;
            transform: translateX(-50%);
            width: 160px; height: 160px;
            background: radial-gradient(circle, rgba(255,240,200,0.2) 0%, rgba(255,240,200,0.05) 40%, transparent 70%);
            pointer-events: none;
        }

        /* PARKED CAR - Real photo cutout */
        .car-cutout {
            position: absolute;
            bottom: 4%; left: 55%;
            width: clamp(120px, 25vw, 200px);
            height: clamp(50px, 10vw, 80px);
            cursor: pointer;
            animation: g-idle 6s ease-in-out infinite;
            animation-delay: -2s;
            z-index: 5;
        }

        .car-cutout img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: brightness(0.4) contrast(1.4) grayscale(60%) sepia(20%);
        }

        .car-cutout:hover img {
            filter: brightness(0.55) contrast(1.4) grayscale(40%) sepia(20%);
        }

        /* Door hotspots */
        .door-zone {
            position: absolute;
            cursor: pointer;
            z-index: 20;
            transition: all 0.3s;
        }

        .door-zone::after {
            content: 'ENTER';
            position: absolute;
            bottom: -20px; left: 50%;
            transform: translateX(-50%);
            font-size: 9px;
            color: #a89870;
            letter-spacing: 2px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .door-zone:hover::after { opacity: 1; }

        .door-zone:hover {
            box-shadow: 0 0 25px rgba(255,200,100,0.3);
        }

        .door-bar { bottom: 20%; left: 7%; width: 8%; height: 18%; background: rgba(255,50,50,0.05); }
        .door-office { bottom: 20%; left: 33%; width: 7%; height: 16%; background: rgba(200,170,120,0.05); }
        .door-hotel { bottom: 20%; left: 58%; width: 7%; height: 16%; background: rgba(50,100,255,0.05); }

        /* =============================================
           CHARACTERS - Photo-collage cutout puppets
        ============================================= */
        .character {
            position: absolute;
            z-index: 50;
            transform-origin: bottom center;
            cursor: pointer;
        }

        .character.idle { animation: g-idle 4s ease-in-out infinite; }
        .character.walking { animation: g-walk 0.4s ease-in-out infinite; }
        .character.talking { animation: g-talk 0.3s ease-in-out infinite; }

        /* PLAYER DETECTIVE */
        #player {
            width: clamp(50px, 8vw, 65px);
            height: clamp(120px, 20vw, 155px);
            z-index: 100;
        }

        /* Detective constructed from vintage photo fragments */
        .det-hat {
            position: absolute;
            top: 0; left: 50%;
            transform: translateX(-50%);
            width: 75%;
            height: 16%;
            background: #0e0c0a;
            border-radius: 3px 3px 0 0;
        }
        .det-hat::after {
            content: '';
            position: absolute;
            bottom: -3px; left: -10%;
            width: 120%; height: 5px;
            background: #0e0c0a;
            border-radius: 2px;
        }
        .det-face {
            position: absolute;
            top: 16%; left: 50%;
            transform: translateX(-50%);
            width: 50%; height: 18%;
            background: linear-gradient(to bottom, #c8a880, #b09068);
            border-radius: 3px 3px 5px 5px;
        }
        /* Eyes */
        .det-face::before {
            content: '';
            position: absolute;
            top: 35%; left: 20%;
            width: 15%; height: 8%;
            background: #2a2018;
            box-shadow: 12px 0 0 #2a2018;
            border-radius: 1px;
        }
        .det-coat {
            position: absolute;
            top: 32%; left: 0;
            width: 100%; height: 68%;
            background: linear-gradient(to bottom, #12100e 0%, #0a0808 100%);
            clip-path: polygon(
                30% 0%, 70% 0%,
                78% 8%, 85% 25%,
                100% 30%, 97% 90%,
                70% 100%, 30% 100%,
                3% 90%, 0% 30%,
                15% 25%, 22% 8%
            );
        }
        /* Coat collar */
        .det-coat::before {
            content: '';
            position: absolute;
            top: 0; left: 25%;
            width: 50%; height: 15%;
            background: #1a1815;
            clip-path: polygon(0% 0%, 50% 100%, 100% 0%);
        }
        .det-shadow {
            position: absolute;
            bottom: -4px; left: 10%;
            width: 80%; height: 8px;
            background: rgba(0,0,0,0.5);
            border-radius: 50%;
            filter: blur(3px);
        }

        /* FEMME FATALE */
        .npc-vivian {
            width: clamp(40px, 7vw, 50px);
            height: clamp(115px, 18vw, 140px);
        }

        .viv-hair {
            position: absolute;
            top: 0; left: 50%;
            transform: translateX(-50%);
            width: 65%; height: 18%;
            background: #0e0805;
            border-radius: 50% 50% 35% 35%;
        }
        .viv-face {
            position: absolute;
            top: 12%; left: 50%;
            transform: translateX(-50%);
            width: 45%; height: 14%;
            background: linear-gradient(to bottom, #e0c8b0, #d0b898);
            border-radius: 3px 3px 5px 5px;
        }
        /* Lips */
        .viv-face::after {
            content: '';
            position: absolute;
            bottom: 20%; left: 30%;
            width: 40%; height: 4px;
            background: #8a2020;
            border-radius: 2px;
        }
        .viv-dress {
            position: absolute;
            top: 25%; left: 0;
            width: 100%; height: 75%;
            background: linear-gradient(to bottom, #2a1018 0%, #180810 100%);
            clip-path: polygon(
                35% 0%, 65% 0%,
                72% 12%, 74% 35%,
                65% 42%, 78% 100%,
                22% 100%, 35% 42%,
                26% 35%, 28% 12%
            );
        }
        /* Cigarette */
        .viv-cig {
            position: absolute;
            top: 38%; right: -18%;
            width: 35%; height: 3px;
            background: linear-gradient(to right, #e8e0d8, #ff5500);
        }
        .viv-smoke {
            position: absolute;
            top: -5px; right: 0;
            width: 8px; height: 8px;
            background: rgba(180,180,180,0.35);
            border-radius: 50%;
            animation: smoke 2.5s ease-out infinite;
        }
        .viv-smoke:nth-child(2) { animation-delay: -0.8s; }
        .viv-smoke:nth-child(3) { animation-delay: -1.6s; }

        /* BARTENDER */
        .npc-bartender {
            width: clamp(45px, 7vw, 55px);
            height: clamp(110px, 17vw, 135px);
        }

        .bart-face {
            position: absolute;
            top: 5%; left: 50%;
            transform: translateX(-50%);
            width: 50%; height: 16%;
            background: linear-gradient(to bottom, #c0a080, #a88868);
            border-radius: 4px 4px 6px 6px;
        }
        .bart-body {
            position: absolute;
            top: 20%; left: 0;
            width: 100%; height: 80%;
            background: #1a1818;
            clip-path: polygon(20% 0%, 80% 0%, 85% 15%, 90% 50%, 85% 100%, 15% 100%, 10% 50%, 15% 15%);
        }
        .bart-apron {
            position: absolute;
            bottom: 0; left: 22%;
            width: 56%; height: 45%;
            background: #d8d0c8;
        }
        .bart-towel {
            position: absolute;
            top: 30%; right: -10%;
            width: 30%; height: 5px;
            background: #d0c8c0;
            transform: rotate(-15deg);
        }

        /* Interaction indicator */
        .interact-hint {
            position: absolute;
            top: -22px; left: 50%;
            transform: translateX(-50%);
            font-size: 16px;
            color: #c4a35a;
            opacity: 0;
            transition: opacity 0.3s;
            animation: float 1.2s ease-in-out infinite;
            pointer-events: none;
        }
        .character:hover .interact-hint { opacity: 1; }

        /* =============================================
           CLUE ITEMS - Scattered paper/objects
        ============================================= */
        .clue {
            position: absolute;
            cursor: pointer;
            z-index: 30;
            animation: float 3s ease-in-out infinite;
            transition: transform 0.2s, filter 0.2s;
        }
        .clue:hover {
            transform: scale(1.15);
            filter: brightness(1.4);
        }

        /* Newspaper */
        .clue-paper {
            bottom: 6%; left: 22%;
            width: 40px; height: 50px;
            background: #e8e0d0;
            transform: rotate(-4deg);
            box-shadow: 2px 2px 6px rgba(0,0,0,0.5);
            font-size: 4px;
            padding: 4px;
            color: #333;
            line-height: 1.2;
            overflow: hidden;
        }
        .clue-paper::before {
            content: 'DAILY NEWS';
            display: block;
            font-family: serif;
            font-weight: bold;
            font-size: 6px;
            border-bottom: 1px solid #333;
            margin-bottom: 2px;
            text-align: center;
        }
        .clue-paper::after {
            content: 'WOMAN FOUND DEAD AT AVALON HOTEL';
            display: block;
            font-weight: bold;
            font-size: 5px;
            margin-top: 2px;
        }

        /* Matchbook */
        .clue-match {
            bottom: 5%; left: 72%;
            width: 22px; height: 28px;
            background: linear-gradient(to bottom, #8b0000, #5a0000);
            border-radius: 2px 2px 0 0;
            box-shadow: 1px 2px 4px rgba(0,0,0,0.6);
            animation-delay: -1.5s;
        }
        .clue-match::before {
            content: 'BLUE MOON';
            position: absolute;
            top: 30%; left: 50%;
            transform: translateX(-50%);
            font-size: 3px;
            color: #d4a030;
            white-space: nowrap;
        }

        /* =============================================
           INTERIOR SCENES
        ============================================= */
        /* BAR */
        #scene-bar {
            background: linear-gradient(to bottom, #0e0a14 0%, #08060c 100%);
        }

        .bar-photo-bg {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 70%;
            overflow: hidden;
        }

        /* Bar shelves - constructed from CSS */
        .bar-shelf {
            position: absolute;
            background: #1a1515;
            border: 2px solid #2a2020;
        }
        .bar-shelf-1 { top: 12%; left: 8%; width: 84%; height: 20%; }
        .bar-shelf-2 { top: 35%; left: 8%; width: 84%; height: 18%; }

        /* Bottles as cutout rectangles */
        .bottle {
            position: absolute;
            border-radius: 3px 3px 0 0;
        }

        .bar-mirror {
            position: absolute;
            top: 5%; left: 15%;
            width: 70%; height: 55%;
            background: linear-gradient(135deg, rgba(40,35,50,0.6) 0%, rgba(20,18,28,0.8) 100%);
            border: 4px solid #2a2525;
        }

        .bar-counter-top {
            position: absolute;
            bottom: 22%; left: 3%;
            width: 94%; height: 12%;
            background: linear-gradient(to bottom, #3a2518, #2a1810);
            border-top: 6px solid #4a3020;
        }

        .bar-stool {
            position: absolute;
            bottom: 12%;
        }
        .stool-top { width: 28px; height: 8px; background: #2a1a12; border-radius: 3px; }
        .stool-leg { width: 4px; height: 45px; background: #1a1a1a; margin: 0 auto; }

        .bar-floor {
            position: absolute;
            bottom: 0; left: 0;
            width: 100%; height: 15%;
            background: linear-gradient(to bottom, #12100c, #0a0808);
        }

        /* Neon beer sign cutout */
        .beer-sign {
            position: absolute;
            top: 8%; right: 12%;
            font-family: cursive;
            font-size: 16px;
            color: #ffaa33;
            text-shadow: 0 0 8px #ffaa33, 0 0 16px #ff8811;
            animation: neon-buzz 4s ease-in-out infinite;
            transform: rotate(-3deg);
        }

        /* OFFICE */
        #scene-office {
            background: #12100d;
        }

        .office-wall {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 72%;
            background: linear-gradient(to bottom, #28221a, #1e1810);
        }

        .office-window {
            position: absolute;
            top: 8%; right: 12%;
            width: clamp(140px, 25vw, 200px);
            height: clamp(110px, 20vw, 160px);
            background: linear-gradient(to bottom, #1a2535, #0e1520);
            border: 5px solid #2a2015;
        }

        /* Venetian blinds */
        .blinds {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent 0px, transparent 8px,
                rgba(255,240,200,0.06) 8px, rgba(255,240,200,0.06) 11px
            );
        }

        /* Light rays through blinds */
        .light-rays {
            position: absolute;
            top: 8%; right: 5%;
            width: 280px; height: 350px;
            background: repeating-linear-gradient(
                -25deg,
                transparent 0px, transparent 14px,
                rgba(255,240,200,0.025) 14px, rgba(255,240,200,0.025) 16px
            );
            transform: skewX(-10deg);
            pointer-events: none;
        }

        /* Real typewriter photo cutout */
        .typewriter-cutout {
            position: absolute;
            bottom: 33%; left: 42%;
            width: clamp(60px, 12vw, 90px);
            height: clamp(45px, 9vw, 65px);
            cursor: pointer;
            z-index: 15;
        }

        .typewriter-cutout img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: brightness(0.7) contrast(1.3) grayscale(50%) sepia(20%);
        }

        .typewriter-cutout:hover img {
            filter: brightness(0.85) contrast(1.3) grayscale(30%) sepia(20%);
        }

        .office-desk {
            position: absolute;
            bottom: 18%; left: 20%;
            width: 60%; height: 16%;
            background: #3d2a18;
            border-top: 5px solid #4a3520;
        }

        .office-chair {
            position: absolute;
            bottom: 16%; left: 32%;
            width: 55px; height: 90px;
        }
        .chair-back { width: 45px; height: 55px; background: #2a1a10; border-radius: 4px 4px 0 0; margin: 0 auto; }
        .chair-seat { width: 50px; height: 12px; background: #2a1a10; margin: 0 auto; }

        /* Desk lamp */
        .desk-lamp {
            position: absolute;
            bottom: 32%; left: 25%;
            width: 45px; height: 65px;
        }
        .lamp-shade { width: 35px; height: 24px; background: #2a4030; border-radius: 0 0 18px 18px; margin: 0 auto; }
        .lamp-arm { width: 4px; height: 35px; background: linear-gradient(to right, #8a7040, #c4a860, #8a7040); margin: 0 auto; }
        .lamp-cone {
            position: absolute;
            bottom: -20px; left: 50%;
            transform: translateX(-50%);
            width: 100px; height: 70px;
            background: radial-gradient(ellipse at top, rgba(255,240,200,0.12) 0%, transparent 70%);
        }

        .office-filing {
            position: absolute;
            bottom: 13%; left: 6%;
            width: 45px; height: 110px;
            background: #3a3a3a;
            cursor: pointer;
            z-index: 15;
        }
        .filing-dr { width: 100%; height: 32%; border-bottom: 2px solid #2a2a2a; }
        .filing-dr::after { content: ''; display: block; width: 12px; height: 3px; background: #555; margin: 45% auto 0; }

        .office-floor {
            position: absolute;
            bottom: 0; left: 0;
            width: 100%; height: 16%;
            background: linear-gradient(to bottom, #1a1510, #12100c);
        }

        /* =============================================
           EXIT BUTTON
        ============================================= */
        .exit-btn {
            position: absolute;
            bottom: 20px; left: 20px;
            padding: 10px 22px;
            background: rgba(25, 20, 15, 0.9);
            border: 2px solid #4a3a2a;
            color: #c4a35a;
            font-family: 'Special Elite', monospace;
            font-size: 13px;
            cursor: pointer;
            z-index: 300;
            letter-spacing: 2px;
        }
        .exit-btn:hover { background: rgba(50, 40, 30, 0.9); }

        /* =============================================
           UI
        ============================================= */
        #ui {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 500;
        }
        #ui > * { pointer-events: auto; }

        #dialogue {
            position: absolute;
            bottom: 60px; left: 50%;
            transform: translateX(-50%);
            width: 88%; max-width: 520px;
            background: rgba(10, 8, 6, 0.95);
            border: 2px solid #3d3020;
            border-left: 4px solid #c4a35a;
            padding: 16px 18px;
            display: none;
            box-shadow: 0 8px 40px rgba(0,0,0,0.8);
        }
        #dialogue.visible { display: block; }

        .dlg-speaker {
            font-family: 'Playfair Display', serif;
            font-size: 12px;
            color: #c4a35a;
            letter-spacing: 3px;
            margin-bottom: 8px;
            text-transform: uppercase;
        }
        .dlg-text {
            font-family: 'Special Elite', monospace;
            font-size: 15px;
            color: #d4c5a9;
            line-height: 1.6;
        }
        .dlg-continue {
            font-size: 10px;
            color: #5a4a3a;
            margin-top: 10px;
            text-align: right;
            animation: pulse 2s ease-in-out infinite;
        }

        #location-title {
            position: absolute;
            top: 22px; left: 50%;
            transform: translateX(-50%);
            font-family: 'Playfair Display', serif;
            font-size: clamp(20px, 5vw, 30px);
            color: #b4a484;
            letter-spacing: 6px;
            text-transform: uppercase;
            text-shadow: 0 2px 15px rgba(0,0,0,0.9);
            opacity: 0;
            transition: opacity 0.8s;
        }
        #location-title.visible { opacity: 1; }

        #inventory {
            position: absolute;
            top: 18px; left: 18px;
            display: flex;
            gap: 6px;
        }
        .inv-slot {
            width: 40px; height: 40px;
            background: rgba(20, 18, 12, 0.85);
            border: 2px solid #3a2a1a;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        #hint {
            position: absolute;
            bottom: 12px; left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            color: #5a4a3a;
            letter-spacing: 1px;
            white-space: nowrap;
        }

        /* Film effects */
        #grain {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            opacity: 0.06;
            z-index: 1000;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
        }
        #vignette {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            background: radial-gradient(ellipse at center, transparent 35%, rgba(0,0,0,0.7) 100%);
            z-index: 999;
        }

        /* Title screen */
        #title {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background: #080608;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: opacity 1.5s;
        }
        #title.hidden { opacity: 0; pointer-events: none; }

        #title h1 {
            font-family: 'Playfair Display', serif;
            font-weight: 900;
            font-size: clamp(42px, 14vw, 130px);
            color: transparent;
            -webkit-text-stroke: 2px #a08050;
            letter-spacing: 10px;
            margin-bottom: 20px;
        }
        #title .sub {
            font-family: 'Special Elite', monospace;
            font-size: clamp(10px, 3vw, 16px);
            color: #3a2a1a;
            letter-spacing: 8px;
            margin-bottom: 50px;
        }
        #title .go {
            font-size: 12px;
            color: #2a1a0a;
            letter-spacing: 3px;
            animation: pulse 2.5s ease-in-out infinite;
        }
        #title .yr {
            position: absolute;
            bottom: 30px;
            font-family: 'Playfair Display', serif;
            font-size: 15px;
            color: #1a0a00;
            letter-spacing: 4px;
        }
    </style>
</head>
<body>
<div id="game">

    <!-- ============ STREET SCENE ============ -->
    <div id="scene-street" class="scene active">
        <!-- Real photo backdrop: 52nd Street NYC (Gottlieb, LOC) -->
        <div class="street-photo-bg">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a4/Gottlieb_52nd_Street.jpg/1280px-Gottlieb_52nd_Street.jpg"
                 alt="52nd Street NYC 1948"
                 crossorigin="anonymous"
                 onerror="this.parentElement.style.background='linear-gradient(to bottom,#0a0a15,#151525)'">
        </div>
        <div class="street-overlay"></div>

        <!-- Moon -->
        <div class="moon-cutout"></div>

        <!-- Building silhouettes -->
        <div class="building-cutout bldg-1"></div>
        <div class="building-cutout bldg-2"></div>
        <div class="building-cutout bldg-3"></div>
        <div class="building-cutout bldg-4"></div>

        <!-- Lit windows -->
        <div class="win" style="bottom:52%;left:6%;width:4px;height:6px;"></div>
        <div class="win" style="bottom:48%;left:9%;width:3px;height:5px;"></div>
        <div class="win" style="bottom:45%;left:28%;width:4px;height:7px;"></div>
        <div class="win" style="bottom:50%;left:30%;width:3px;height:5px;"></div>
        <div class="win" style="bottom:40%;left:50%;width:4px;height:6px;"></div>
        <div class="win" style="bottom:43%;left:53%;width:3px;height:5px;"></div>
        <div class="win" style="bottom:47%;left:75%;width:4px;height:6px;"></div>
        <div class="win" style="bottom:38%;left:85%;width:3px;height:5px;"></div>

        <!-- Neon signs -->
        <div class="neon neon-bar" data-door="bar">BAR</div>
        <div class="neon neon-hotel" data-door="hotel">HOTEL</div>
        <div class="neon neon-eats">EATS</div>
        <div class="neon neon-office" data-door="office">NOIR INVESTIGATIONS</div>

        <!-- Streetlamps -->
        <div class="streetlamp" style="left:25%;">
            <div class="lamp-fixture"></div>
            <div class="lamp-pole"></div>
            <div class="lamp-glow"></div>
        </div>
        <div class="streetlamp" style="left:68%;">
            <div class="lamp-fixture"></div>
            <div class="lamp-pole"></div>
            <div class="lamp-glow"></div>
        </div>

        <!-- Street ground -->
        <div class="street-ground">
            <div class="sidewalk"></div>
            <div class="wet-reflect wet-r1"></div>
            <div class="wet-reflect wet-r2"></div>
            <div class="wet-reflect wet-r3"></div>
        </div>

        <!-- Car cutout (real photo) -->
        <div class="car-cutout" id="obj-car">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3f/1957_Chevrolet_Bel_Air_Sport_Sedan_%2826233032368%29.jpg/640px-1957_Chevrolet_Bel_Air_Sport_Sedan_%2826233032368%29.jpg"
                 alt="1957 Chevrolet"
                 crossorigin="anonymous"
                 onerror="this.style.display='none';this.parentElement.style.background='#0a0808';this.parentElement.style.clipPath='polygon(0% 100%, 0% 60%, 8% 40%, 25% 25%, 45% 5%, 70% 5%, 88% 25%, 100% 50%, 100% 100%)'">
            <span class="interact-hint">?</span>
        </div>

        <!-- Door zones -->
        <div class="door-zone door-bar" data-door="bar"></div>
        <div class="door-zone door-office" data-door="office"></div>
        <div class="door-zone door-hotel" data-door="hotel"></div>

        <!-- Clue items -->
        <div class="clue clue-paper" id="clue-newspaper" data-item="newspaper">
            <span class="interact-hint" style="top:-18px;">!</span>
        </div>
        <div class="clue clue-match" id="clue-matchbook" data-item="matchbook">
            <span class="interact-hint" style="top:-18px;">!</span>
        </div>

        <!-- Femme Fatale NPC -->
        <div class="character npc-vivian idle" id="npc-vivian" style="left:38%;bottom:20%;" data-npc="vivian">
            <div class="viv-hair"></div>
            <div class="viv-face"></div>
            <div class="viv-dress"></div>
            <div class="viv-cig">
                <div class="viv-smoke"></div>
                <div class="viv-smoke"></div>
                <div class="viv-smoke"></div>
            </div>
            <span class="interact-hint">?</span>
        </div>

        <!-- Player -->
        <div class="character idle" id="player" style="left:18%;bottom:20%;">
            <div class="det-hat"></div>
            <div class="det-face"></div>
            <div class="det-coat"></div>
            <div class="det-shadow"></div>
        </div>
    </div>

    <!-- ============ BAR INTERIOR ============ -->
    <div id="scene-bar" class="scene">
        <div class="bar-mirror"></div>
        <div class="bar-shelf bar-shelf-1">
            <div class="bottle" style="left:5%;top:20%;width:12px;height:55%;background:linear-gradient(#3a2010,#2a1508);border-radius:3px 3px 0 0;"></div>
            <div class="bottle" style="left:15%;top:30%;width:10px;height:45%;background:linear-gradient(#1a3020,#0a2010);border-radius:3px 3px 0 0;"></div>
            <div class="bottle" style="left:25%;top:15%;width:14px;height:60%;background:linear-gradient(#3a3020,#2a2010);border-radius:3px 3px 0 0;"></div>
            <div class="bottle" style="left:38%;top:25%;width:11px;height:50%;background:linear-gradient(#2a1515,#1a0a0a);border-radius:3px 3px 0 0;"></div>
            <div class="bottle" style="left:50%;top:20%;width:13px;height:55%;background:linear-gradient(#302a18,#201a08);border-radius:3px 3px 0 0;"></div>
            <div class="bottle" style="left:63%;top:30%;width:10px;height:45%;background:linear-gradient(#1a2a30,#0a1a20);border-radius:3px 3px 0 0;"></div>
            <div class="bottle" style="left:75%;top:18%;width:12px;height:57%;background:linear-gradient(#3a2518,#2a1508);border-radius:3px 3px 0 0;"></div>
            <div class="bottle" style="left:88%;top:25%;width:11px;height:50%;background:linear-gradient(#2a2020,#1a1010);border-radius:3px 3px 0 0;"></div>
        </div>
        <div class="bar-shelf bar-shelf-2">
            <div class="bottle" style="left:8%;top:15%;width:13px;height:60%;background:linear-gradient(#2a2518,#1a1508);border-radius:3px 3px 0 0;"></div>
            <div class="bottle" style="left:22%;top:25%;width:10px;height:50%;background:linear-gradient(#1a2520,#0a1510);border-radius:3px 3px 0 0;"></div>
            <div class="bottle" style="left:35%;top:20%;width:14px;height:55%;background:linear-gradient(#3a1518,#2a0508);border-radius:3px 3px 0 0;"></div>
            <div class="bottle" style="left:50%;top:15%;width:12px;height:60%;background:linear-gradient(#302518,#201508);border-radius:3px 3px 0 0;"></div>
            <div class="bottle" style="left:65%;top:30%;width:11px;height:45%;background:linear-gradient(#2a2a20,#1a1a10);border-radius:3px 3px 0 0;"></div>
            <div class="bottle" style="left:80%;top:20%;width:13px;height:55%;background:linear-gradient(#352a18,#251a08);border-radius:3px 3px 0 0;"></div>
        </div>
        <div class="beer-sign">Schlitz</div>
        <div class="bar-counter-top"></div>
        <div class="bar-stool" style="left:18%;"><div class="stool-top"></div><div class="stool-leg"></div></div>
        <div class="bar-stool" style="left:32%;"><div class="stool-top"></div><div class="stool-leg"></div></div>
        <div class="bar-stool" style="left:55%;"><div class="stool-top"></div><div class="stool-leg"></div></div>
        <div class="bar-stool" style="left:72%;"><div class="stool-top"></div><div class="stool-leg"></div></div>
        <div class="bar-floor"></div>

        <!-- Bartender -->
        <div class="character npc-bartender idle" id="npc-bartender" style="left:42%;bottom:35%;" data-npc="bartender">
            <div class="bart-face"></div>
            <div class="bart-body">
                <div class="bart-apron"></div>
            </div>
            <div class="bart-towel"></div>
            <span class="interact-hint">?</span>
        </div>

        <button class="exit-btn" data-exit="street">EXIT</button>
    </div>

    <!-- ============ OFFICE INTERIOR ============ -->
    <div id="scene-office" class="scene">
        <div class="office-wall"></div>
        <div class="office-window">
            <div class="blinds"></div>
        </div>
        <div class="light-rays"></div>

        <div class="office-desk"></div>
        <div class="office-chair">
            <div class="chair-back"></div>
            <div class="chair-seat"></div>
        </div>

        <!-- Real typewriter photo -->
        <div class="typewriter-cutout" id="obj-typewriter" data-look="typewriter">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a0/Underwoodfive.jpg/320px-Underwoodfive.jpg"
                 alt="Underwood Typewriter"
                 crossorigin="anonymous"
                 onerror="this.style.display='none';this.parentElement.style.background='#1a1a1a';this.parentElement.style.borderRadius='5px 5px 0 0'">
            <span class="interact-hint">?</span>
        </div>

        <div class="desk-lamp">
            <div class="lamp-shade"></div>
            <div class="lamp-arm"></div>
            <div class="lamp-cone"></div>
        </div>

        <div class="office-filing" id="obj-filing" data-look="filing">
            <div class="filing-dr"></div>
            <div class="filing-dr"></div>
            <div class="filing-dr"></div>
            <span class="interact-hint">?</span>
        </div>

        <div class="office-floor"></div>

        <button class="exit-btn" data-exit="street">EXIT</button>
    </div>

    <!-- ============ UI ============ -->
    <div id="ui">
        <div id="location-title"></div>
        <div id="dialogue">
            <div class="dlg-speaker"></div>
            <div class="dlg-text"></div>
            <div class="dlg-continue">tap to continue</div>
        </div>
        <div id="inventory"></div>
        <div id="hint">CLICK TO MOVE &bull; CLICK OBJECTS TO INTERACT</div>
    </div>

    <div id="vignette"></div>
    <div id="grain"></div>

    <!-- Title -->
    <div id="title">
        <h1>NIGHTFALL</h1>
        <div class="sub">A COLLAGE NOIR</div>
        <div class="go">TAP TO BEGIN</div>
        <div class="yr">1 9 5 9</div>
    </div>
</div>

<script>
// ======================================
// GAME STATE
// ======================================
const G = {
    scene: 'street',
    px: 18,
    inv: [],
    flags: {},
    dq: [],
    di: 0,
    moving: false
};

// ======================================
// DIALOGUE DATA
// ======================================
const D = {
    vivian_intro: [
        { s: "???", t: "You must be the detective. I've heard you take cases the police won't touch." },
        { s: "VIVIAN", t: "My name is Vivian Marlowe. My sister Eleanor was found dead this morning at the Avalon Hotel." },
        { s: "VIVIAN", t: "Room 214. They're calling it suicide. But Eleanor would never do that." },
        { s: "VIVIAN", t: "I need you to find who really killed her. I'll pay whatever it takes." },
        { s: "YOU", t: "I'll look into it. Who were her friends? Enemies?" },
        { s: "VIVIAN", t: "Start at the Blue Moon bar. She spent her last evening there. Ask for Mickey." }
    ],
    vivian_again: [
        { s: "VIVIAN", t: "Have you found anything?" },
        { s: "YOU", t: "Working on it. These things take time." },
        { s: "VIVIAN", t: "Time is something Eleanor doesn't have anymore." }
    ],
    bartender_intro: [
        { s: "MICKEY", t: "What can I get ya?" },
        { s: "YOU", t: "Information. I'm looking into the Marlowe case." },
        { s: "MICKEY", t: "Eleanor? She was in here last night. Looked scared. Kept watching the door." },
        { s: "MICKEY", t: "She was meeting someone. Big guy, gray suit. They argued. She left in a hurry." },
        { s: "YOU", t: "You get a name?" },
        { s: "MICKEY", t: "Didn't catch one. But he works for Castellano. I'd watch your back." }
    ],
    bartender_again: [
        { s: "MICKEY", t: "Still working that case?" },
        { s: "YOU", t: "Castellano. Where do I find him?" },
        { s: "MICKEY", t: "You don't find Castellano. He finds you. That's usually bad news." }
    ],
    car: [
        { s: "NARRATOR", t: "A '57 Bel Air. Chrome catching neon like blood on a knife." },
        { s: "NARRATOR", t: "Someone parked in a hurry. The door isn't quite closed." }
    ],
    typewriter: [
        { s: "NARRATOR", t: "My old Underwood. The 'e' key sticks but it still tells the truth." },
        { s: "NARRATOR", t: "Half-finished case reports. Unpaid bills. The usual." }
    ],
    filing: [
        { s: "NARRATOR", t: "Case files. Most of them cold. Just like the trails that led nowhere." },
        { s: "NARRATOR", t: "Maybe Eleanor Marlowe's file will be different." }
    ],
    newspaper: [
        { s: "NARRATOR", t: "Today's paper. 'WOMAN FOUND DEAD AT AVALON HOTEL'" },
        { s: "NARRATOR", t: "Police calling it suicide. Since when do they investigate those?" }
    ],
    matchbook: [
        { s: "NARRATOR", t: "A matchbook. 'The Blue Moon' printed in gold on crimson." },
        { s: "NARRATOR", t: "Dropped recently. The cardboard's barely damp." }
    ],
    hotel_locked: [
        { s: "NARRATOR", t: "The Avalon Hotel. Room 214 is up there somewhere." },
        { s: "NARRATOR", t: "The lobby door is locked at this hour. I'll need another way in." }
    ]
};

// ======================================
// DOM
// ======================================
const $ = id => document.getElementById(id);
const player = $('player');
const dlg = $('dialogue');
const locTitle = $('location-title');
const invEl = $('inventory');
const hint = $('hint');

// ======================================
// PLAYER MOVEMENT
// ======================================
function movePlayer(tx, cb) {
    if (G.moving) return;
    const dx = Math.abs(tx - G.px);
    if (dx < 2) { if (cb) cb(); return; }

    G.moving = true;
    player.classList.replace('idle', 'walking');
    player.style.transform = tx < G.px ? 'scaleX(-1)' : 'scaleX(1)';

    const ms = dx * 25;
    player.style.transition = `left ${ms}ms linear`;
    player.style.left = tx + '%';
    G.px = tx;

    setTimeout(() => {
        G.moving = false;
        player.classList.replace('walking', 'idle');
        player.style.transition = '';
        if (cb) cb();
    }, ms);
}

// ======================================
// DIALOGUE
// ======================================
function talk(key) {
    if (!D[key]) return;
    G.dq = D[key];
    G.di = 0;
    nextLine();
}

function nextLine() {
    if (G.di >= G.dq.length) { closeDlg(); return; }
    const l = G.dq[G.di];
    dlg.querySelector('.dlg-speaker').textContent = l.s;
    dlg.querySelector('.dlg-text').textContent = l.t;
    dlg.classList.add('visible');
}

function advDlg() { G.di++; nextLine(); }

function closeDlg() {
    dlg.classList.remove('visible');
    G.dq = []; G.di = 0;
    document.querySelectorAll('.talking').forEach(e => { e.classList.remove('talking'); e.classList.add('idle'); });
}

// ======================================
// INTERACTIONS
// ======================================
function talkNPC(id) {
    const el = $(id);
    if (!el) return;
    el.classList.remove('idle');
    el.classList.add('talking');

    const type = el.dataset.npc;
    if (type === 'vivian') talk(G.flags.met_vivian ? 'vivian_again' : 'vivian_intro'), G.flags.met_vivian = true;
    else if (type === 'bartender') talk(G.flags.talked_bart ? 'bartender_again' : 'bartender_intro'), G.flags.talked_bart = true;
}

function collect(el, id) {
    if (G.inv.includes(id)) return;
    G.inv.push(id);
    el.style.display = 'none';
    talk(id);
    renderInv();
}

function renderInv() {
    invEl.innerHTML = '';
    G.inv.forEach(i => {
        const d = document.createElement('div');
        d.className = 'inv-slot';
        d.textContent = i === 'newspaper' ? '\u{1F4F0}' : '\u{1F525}';
        invEl.appendChild(d);
    });
}

// ======================================
// SCENE TRANSITIONS
// ======================================
function goScene(id) {
    document.querySelectorAll('.scene').forEach(s => s.classList.remove('active'));
    $('scene-' + id).classList.add('active');
    G.scene = id;
    const names = { street: 'MAIN STREET', bar: 'THE BLUE MOON', office: 'NOIR INVESTIGATIONS' };
    showLoc(names[id] || id.toUpperCase());
}

function showLoc(name) {
    locTitle.textContent = name;
    locTitle.classList.add('visible');
    setTimeout(() => locTitle.classList.remove('visible'), 2500);
}

// ======================================
// INPUT
// ======================================
function setup() {
    // Title
    $('title').addEventListener('click', () => {
        $('title').classList.add('hidden');
        showLoc('MAIN STREET');
        setTimeout(() => { hint.style.opacity = '0'; }, 5000);
    });

    // Street click-to-move
    $('scene-street').addEventListener('click', e => {
        if (dlg.classList.contains('visible')) { advDlg(); return; }
        const r = $('scene-street').getBoundingClientRect();
        const x = ((e.clientX - r.left) / r.width) * 100;
        movePlayer(Math.max(4, Math.min(92, x)));
    });

    // NPCs
    document.querySelectorAll('[data-npc]').forEach(n => {
        n.addEventListener('click', e => {
            e.stopPropagation();
            if (dlg.classList.contains('visible')) { advDlg(); return; }
            const nx = parseFloat(n.style.left);
            movePlayer(nx - 8, () => talkNPC(n.id));
        });
    });

    // Lookable objects
    document.querySelectorAll('[data-look]').forEach(o => {
        o.addEventListener('click', e => {
            e.stopPropagation();
            if (dlg.classList.contains('visible')) { advDlg(); return; }
            talk(o.dataset.look);
        });
    });

    // Car
    $('obj-car').addEventListener('click', e => {
        e.stopPropagation();
        if (dlg.classList.contains('visible')) { advDlg(); return; }
        talk('car');
    });

    // Collectibles
    document.querySelectorAll('[data-item]').forEach(c => {
        c.addEventListener('click', e => {
            e.stopPropagation();
            if (dlg.classList.contains('visible')) { advDlg(); return; }
            collect(c, c.dataset.item);
        });
    });

    // Doors & neon signs
    document.querySelectorAll('[data-door]').forEach(d => {
        d.addEventListener('click', e => {
            e.stopPropagation();
            if (dlg.classList.contains('visible')) { advDlg(); return; }
            const t = d.dataset.door;
            if (t === 'bar' || t === 'office') goScene(t);
            else talk('hotel_locked');
        });
    });

    // Exit buttons
    document.querySelectorAll('[data-exit]').forEach(b => {
        b.addEventListener('click', e => { e.stopPropagation(); goScene('street'); });
    });

    // Dialogue advance
    dlg.addEventListener('click', e => { e.stopPropagation(); advDlg(); });

    // Interior scene clicks
    ['scene-bar', 'scene-office'].forEach(id => {
        $(id).addEventListener('click', e => {
            if (dlg.classList.contains('visible')) { advDlg(); }
        });
    });

    // Keyboard
    document.addEventListener('keydown', e => {
        if (e.key === ' ' || e.key === 'Enter') { if (dlg.classList.contains('visible')) advDlg(); }
        if (e.key === 'Escape') closeDlg();
    });
}

setup();
</script>
</body>
</html>

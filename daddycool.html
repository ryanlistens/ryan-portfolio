<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daddy Cool - A 70s Detective Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier Prime', monospace;
            background: #000;
            color: #fff;
            overflow: hidden;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"><circle cx="10" cy="10" r="8" fill="%23ff8800" opacity="0.6"/></svg>'), auto;
        }

        #landing-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 0, 102, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 255, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(255, 255, 0, 0.1) 0%, transparent 60%),
                #000;
            z-index: 1000;
            transition: opacity 1s ease-out;
        }

        #landing-screen.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .title-container {
            text-align: center;
            animation: fadeInDown 1.5s ease-out;
        }

        .game-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: clamp(60px, 12vw, 180px);
            letter-spacing: 15px;
            color: #ff8800;
            text-shadow: 
                0 0 20px rgba(255, 136, 0, 0.8),
                0 0 40px rgba(255, 136, 0, 0.6),
                0 0 60px rgba(255, 136, 0, 0.4),
                0 0 80px rgba(255, 136, 0, 0.2),
                4px 4px 0 rgba(255, 0, 102, 0.5),
                -4px -4px 0 rgba(0, 255, 255, 0.5);
            animation: neonPulse 2s ease-in-out infinite;
            margin-bottom: 20px;
        }

        .subtitle {
            font-size: clamp(16px, 2vw, 24px);
            letter-spacing: 8px;
            color: #00ffff;
            text-shadow: 
                0 0 10px rgba(0, 255, 255, 0.8),
                2px 2px 4px rgba(0, 0, 0, 0.8);
            margin-bottom: 60px;
            animation: fadeIn 2s ease-out 0.5s both;
        }

        .start-button {
            font-family: 'Bebas Neue', sans-serif;
            font-size: clamp(24px, 3vw, 36px);
            letter-spacing: 6px;
            padding: 20px 60px;
            background: linear-gradient(135deg, #ff0066 0%, #ff8800 100%);
            border: 3px solid #ff8800;
            color: #fff;
            cursor: pointer;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            box-shadow: 
                0 0 20px rgba(255, 136, 0, 0.6),
                inset 0 0 20px rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            animation: fadeIn 2s ease-out 1s both, float 3s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }

        .start-button::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(255, 255, 255, 0.3) 50%,
                transparent 70%
            );
            animation: shine 3s infinite;
        }

        .start-button:hover {
            transform: scale(1.05);
            box-shadow: 
                0 0 40px rgba(255, 136, 0, 0.9),
                inset 0 0 30px rgba(255, 255, 255, 0.3);
            border-color: #ffff00;
        }

        .start-button:active {
            transform: scale(0.98);
        }

        .credits {
            position: absolute;
            bottom: 40px;
            font-size: 14px;
            letter-spacing: 2px;
            color: #ff8800;
            opacity: 0.6;
            animation: fadeIn 2s ease-out 1.5s both;
        }

        /* Disco ball effect */
        .disco-ball {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100px;
            height: 100px;
            transform: translate(-50%, -50%);
            opacity: 0.03;
            animation: rotate 20s linear infinite;
            pointer-events: none;
        }

        .disco-ball::before,
        .disco-ball::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: 
                repeating-linear-gradient(0deg, transparent 0%, #fff 2%, transparent 4%),
                repeating-linear-gradient(90deg, transparent 0%, #fff 2%, transparent 4%);
        }

        /* Scanlines effect */
        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.15) 0px,
                transparent 1px,
                transparent 2px,
                rgba(0, 0, 0, 0.15) 3px
            );
            pointer-events: none;
            opacity: 0.3;
            z-index: 2000;
        }

        @keyframes neonPulse {
            0%, 100% {
                text-shadow: 
                    0 0 20px rgba(255, 136, 0, 0.8),
                    0 0 40px rgba(255, 136, 0, 0.6),
                    0 0 60px rgba(255, 136, 0, 0.4),
                    0 0 80px rgba(255, 136, 0, 0.2),
                    4px 4px 0 rgba(255, 0, 102, 0.5),
                    -4px -4px 0 rgba(0, 255, 255, 0.5);
            }
            50% {
                text-shadow: 
                    0 0 30px rgba(255, 136, 0, 1),
                    0 0 50px rgba(255, 136, 0, 0.8),
                    0 0 70px rgba(255, 136, 0, 0.6),
                    0 0 90px rgba(255, 136, 0, 0.4),
                    6px 6px 0 rgba(255, 0, 102, 0.7),
                    -6px -6px 0 rgba(0, 255, 255, 0.7);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes rotate {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        @keyframes shine {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* Game container */
        #game-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: none;
            z-index: 500;
        }

        #game-container.active {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Scanlines overlay -->
    <div class="scanlines"></div>

    <!-- Landing Screen -->
    <div id="landing-screen">
        <div class="disco-ball"></div>
        
        <div class="title-container">
            <h1 class="game-title">DADDY COOL</h1>
            <p class="subtitle">A 70s DETECTIVE GAME</p>
            <button class="start-button" id="start-button">PRESS START</button>
        </div>

        <div class="credits">
            LITTLE ITALY • SUMMER 1979
        </div>
    </div>

    <!-- Game Container -->
    <div id="game-container"></div>

    <!-- Load React and Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <!-- Game Code -->
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const DiscoDetectiveGame = () => {
          const containerRef = useRef(null);
          const audioRef = useRef(null);
          const [gameState, setGameState] = useState('intro');
          const [titleText, setTitleText] = useState('');
          const [dialogue, setDialogue] = useState(null);
          const [playerPos, setPlayerPos] = useState({ x: 8, z: 8 });
          const [isStanding, setIsStanding] = useState(false);
          
          const fullTitle = "Nightclub interior.  Little Italy.  Summer 1979.  11:54 PM.";

          // Music handling
          useEffect(() => {
            audioRef.current = new Audio('/music/nightclub.mp3');
            audioRef.current.loop = true;
            audioRef.current.volume = 0.6;
            
            return () => {
              if (audioRef.current) {
                audioRef.current.pause();
                audioRef.current = null;
              }
            };
          }, []);

          useEffect(() => {
            if (gameState === 'intro') {
              // Start music on intro
              if (audioRef.current) {
                audioRef.current.play().catch(e => console.log('Audio play failed:', e));
              }

              let index = 0;
              const interval = setInterval(() => {
                if (index < fullTitle.length) {
                  setTitleText(fullTitle.slice(0, index + 1));
                  index++;
                } else {
                  clearInterval(interval);
                  setTimeout(() => setGameState('playing'), 1500);
                }
              }, 50);
              return () => clearInterval(interval);
            }
          }, [gameState]);

          useEffect(() => {
            if (gameState !== 'playing' || !containerRef.current) return;

            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a0a0a);
            scene.fog = new THREE.Fog(0x0a0a0a, 15, 35);

            const camera = new THREE.PerspectiveCamera(
              50,
              window.innerWidth / window.innerHeight,
              0.1,
              100
            );
            camera.position.set(0, 18, 22);
            camera.lookAt(0, 0, 0);

            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            containerRef.current.appendChild(renderer.domElement);

            const ambientLight = new THREE.AmbientLight(0x331111, 0.3);
            scene.add(ambientLight);

            const spotLights = [
              { color: 0xff0066, pos: [-6, 8, -6], target: [-6, 0, -6] },
              { color: 0x00ffff, pos: [-3, 8, -6], target: [-3, 0, -6] },
              { color: 0xffff00, pos: [-6, 8, -3], target: [-6, 0, -3] },
              { color: 0x0066ff, pos: [-3, 8, -3], target: [-3, 0, -3] },
            ];

            spotLights.forEach(light => {
              const spotLight = new THREE.SpotLight(light.color, 2, 20, Math.PI / 6, 0.5);
              spotLight.position.set(...light.pos);
              spotLight.target.position.set(...light.target);
              spotLight.castShadow = true;
              scene.add(spotLight);
              scene.add(spotLight.target);
            });

            const tableLight = new THREE.PointLight(0xff8833, 1, 15);
            tableLight.position.set(4, 6, 2);
            scene.add(tableLight);

            const floorGeometry = new THREE.PlaneGeometry(30, 30);
            const floorMaterial = new THREE.MeshStandardMaterial({ 
              color: 0x1a0a0a,
              roughness: 0.8 
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.position.y = -0.01;
            floor.receiveShadow = true;
            scene.add(floor);

            const danceFloorTiles = [];
            const tileColors = [0xff0000, 0x0000ff, 0xffff00, 0xffffff];
            for (let x = 0; x < 4; x++) {
              for (let z = 0; z < 4; z++) {
                const tileGeometry = new THREE.BoxGeometry(1.8, 0.15, 1.8);
                const tileMaterial = new THREE.MeshStandardMaterial({
                  color: tileColors[(x + z) % 4],
                  emissive: tileColors[(x + z) % 4],
                  emissiveIntensity: 0.5,
                  metalness: 0.3,
                  roughness: 0.4
                });
                const tile = new THREE.Mesh(tileGeometry, tileMaterial);
                tile.position.set(-7.5 + x * 2, 0, -7.5 + z * 2);
                tile.castShadow = true;
                tile.receiveShadow = true;
                scene.add(tile);
                danceFloorTiles.push({ mesh: tile, phase: Math.random() * Math.PI * 2 });
              }
            }

            const platformGeometry = new THREE.BoxGeometry(8, 0.3, 10);
            const platformMaterial = new THREE.MeshStandardMaterial({ 
              color: 0x2a1515,
              roughness: 0.9 
            });
            const platform = new THREE.Mesh(platformGeometry, platformMaterial);
            platform.position.set(5, 0.15, 0);
            platform.receiveShadow = true;
            scene.add(platform);

            const carpetGeometry = new THREE.PlaneGeometry(7.5, 9.5);
            const carpetMaterial = new THREE.MeshStandardMaterial({ 
              color: 0x8b0000,
              roughness: 0.95 
            });
            const carpet = new THREE.Mesh(carpetGeometry, carpetMaterial);
            carpet.rotation.x = -Math.PI / 2;
            carpet.position.set(5, 0.31, 0);
            carpet.receiveShadow = true;
            scene.add(carpet);

            const tables = [
              { pos: [4, 0.3, -3], isPlayer: false },
              { pos: [4, 0.3, 0], isPlayer: false },
              { pos: [4, 0.3, 3], isPlayer: false },
              { pos: [7, 0.3, 6], isPlayer: true },
            ];

            tables.forEach((tableData) => {
              const tableTop = new THREE.Mesh(
                new THREE.CylinderGeometry(0.8, 0.8, 0.05, 16),
                new THREE.MeshStandardMaterial({ color: 0x000000, metalness: 0.5 })
              );
              tableTop.position.set(tableData.pos[0], tableData.pos[1] + 0.7, tableData.pos[2]);
              tableTop.castShadow = true;
              scene.add(tableTop);

              const tablecloth = new THREE.Mesh(
                new THREE.CylinderGeometry(0.85, 0.7, 0.7, 16),
                new THREE.MeshStandardMaterial({ color: 0xcc0000, roughness: 0.8 })
              );
              tablecloth.position.set(tableData.pos[0], tableData.pos[1] + 0.35, tableData.pos[2]);
              scene.add(tablecloth);

              const wineGlass = new THREE.Mesh(
                new THREE.CylinderGeometry(0.06, 0.04, 0.2, 8),
                new THREE.MeshStandardMaterial({ 
                  color: 0xffffff, 
                  transparent: true, 
                  opacity: 0.3,
                  metalness: 0.8
                })
              );
              wineGlass.position.set(tableData.pos[0] - 0.3, tableData.pos[1] + 0.85, tableData.pos[2] + 0.2);
              scene.add(wineGlass);

              const whiskey = new THREE.Mesh(
                new THREE.CylinderGeometry(0.08, 0.08, 0.12, 8),
                new THREE.MeshStandardMaterial({ 
                  color: 0x8b4513, 
                  transparent: true, 
                  opacity: 0.6 
                })
              );
              whiskey.position.set(tableData.pos[0] + 0.3, tableData.pos[1] + 0.82, tableData.pos[2] - 0.2);
              scene.add(whiskey);

              if (!tableData.isPlayer) {
                const ladyBody = new THREE.Mesh(
                  new THREE.CylinderGeometry(0.15, 0.25, 0.8, 8),
                  new THREE.MeshStandardMaterial({ 
                    color: [0xff1493, 0x9400d3, 0x00ced1][Math.floor(Math.random() * 3)],
                    metalness: 0.3
                  })
                );
                ladyBody.position.set(tableData.pos[0] - 0.5, tableData.pos[1] + 0.7, tableData.pos[2]);
                ladyBody.castShadow = true;
                scene.add(ladyBody);

                const ladyHead = new THREE.Mesh(
                  new THREE.SphereGeometry(0.15, 8, 8),
                  new THREE.MeshStandardMaterial({ color: 0xffdbac })
                );
                ladyHead.position.set(tableData.pos[0] - 0.5, tableData.pos[1] + 1.25, tableData.pos[2]);
                ladyHead.castShadow = true;
                scene.add(ladyHead);

                const manColors = [0x000000, 0x4169e1, 0x8b0000];
                const manColor = manColors[Math.floor(Math.random() * 3)];
                const manBody = new THREE.Mesh(
                  new THREE.CylinderGeometry(0.2, 0.22, 0.9, 8),
                  new THREE.MeshStandardMaterial({ color: manColor })
                );
                manBody.position.set(tableData.pos[0] + 0.5, tableData.pos[1] + 0.75, tableData.pos[2]);
                manBody.castShadow = true;
                scene.add(manBody);

                const manHead = new THREE.Mesh(
                  new THREE.SphereGeometry(0.15, 8, 8),
                  new THREE.MeshStandardMaterial({ color: 0xffdbac })
                );
                manHead.position.set(tableData.pos[0] + 0.5, tableData.pos[1] + 1.3, tableData.pos[2]);
                manHead.castShadow = true;
                scene.add(manHead);
              }
            });

            const playerGeometry = new THREE.CapsuleGeometry(0.2, 0.6, 8, 16);
            const playerMaterial = new THREE.MeshStandardMaterial({ 
              color: 0x2a2a2a,
              metalness: 0.2,
              roughness: 0.8
            });
            const player = new THREE.Mesh(playerGeometry, playerMaterial);
            player.position.set(8, 0.7, 8);
            player.castShadow = true;
            scene.add(player);

            const playerHead = new THREE.Mesh(
              new THREE.SphereGeometry(0.15, 8, 8),
              new THREE.MeshStandardMaterial({ color: 0xffdbac })
            );
            playerHead.position.set(8, 1.15, 8);
            playerHead.castShadow = true;
            scene.add(playerHead);

            const dateBody = new THREE.Mesh(
              new THREE.CylinderGeometry(0.15, 0.25, 0.8, 8),
              new THREE.MeshStandardMaterial({ color: 0xff69b4, metalness: 0.3 })
            );
            dateBody.position.set(6.5, 0.7, 7.5);
            dateBody.castShadow = true;
            scene.add(dateBody);

            const dateHead = new THREE.Mesh(
              new THREE.SphereGeometry(0.15, 8, 8),
              new THREE.MeshStandardMaterial({ color: 0xffdbac })
            );
            dateHead.position.set(6.5, 1.25, 7.5);
            dateHead.castShadow = true;
            scene.add(dateHead);

            const bathroomGuy = new THREE.Group();
            const guyBody = new THREE.Mesh(
              new THREE.CylinderGeometry(0.2, 0.22, 0.9, 8),
              new THREE.MeshStandardMaterial({ color: 0x000000 })
            );
            guyBody.castShadow = true;
            bathroomGuy.add(guyBody);

            const guyHead = new THREE.Mesh(
              new THREE.SphereGeometry(0.15, 8, 8),
              new THREE.MeshStandardMaterial({ color: 0xffdbac })
            );
            guyHead.position.y = 0.55;
            guyHead.castShadow = true;
            bathroomGuy.add(guyHead);

            const sunglasses = new THREE.Mesh(
              new THREE.BoxGeometry(0.25, 0.05, 0.15),
              new THREE.MeshStandardMaterial({ color: 0xff8800, metalness: 0.9 })
            );
            sunglasses.position.set(0, 0.55, 0.12);
            bathroomGuy.add(sunglasses);

            bathroomGuy.position.set(-1, 0.75, -8);
            scene.add(bathroomGuy);

            const smokeParticles = [];
            const smokeGeometry = new THREE.SphereGeometry(0.3, 8, 8);
            const smokeMaterial = new THREE.MeshBasicMaterial({
              color: 0xaaaaaa,
              transparent: true,
              opacity: 0.15
            });

            for (let i = 0; i < 40; i++) {
              const smoke = new THREE.Mesh(smokeGeometry, smokeMaterial.clone());
              smoke.position.set(
                -6 + Math.random() * 4,
                Math.random() * 3,
                -6 + Math.random() * 4
              );
              scene.add(smoke);
              smokeParticles.push({
                mesh: smoke,
                velocity: { x: (Math.random() - 0.5) * 0.02, y: Math.random() * 0.01, z: (Math.random() - 0.5) * 0.02 }
              });
            }

            const bar = new THREE.Mesh(
              new THREE.BoxGeometry(3, 1.2, 1),
              new THREE.MeshStandardMaterial({ color: 0x4a2511, roughness: 0.6 })
            );
            bar.position.set(-7, 0.6, 8);
            bar.castShadow = true;
            scene.add(bar);

            const wallMaterial = new THREE.MeshStandardMaterial({ 
              color: 0x1a0505,
              roughness: 0.95
            });

            const backWall = new THREE.Mesh(
              new THREE.BoxGeometry(30, 5, 0.5),
              wallMaterial
            );
            backWall.position.set(0, 2.5, -10);
            backWall.receiveShadow = true;
            scene.add(backWall);

            const rightWall = new THREE.Mesh(
              new THREE.BoxGeometry(0.5, 5, 30),
              wallMaterial
            );
            rightWall.position.set(10, 2.5, 0);
            rightWall.receiveShadow = true;
            scene.add(rightWall);

            const keys = { w: false, a: false, s: false, d: false, a_button: false, b_button: false };

            const handleKeyDown = (e) => {
              const key = e.key.toLowerCase();
              if (key === 'w' || key === 'arrowup') keys.w = true;
              if (key === 'a' || key === 'arrowleft') keys.a = true;
              if (key === 's' || key === 'arrowdown') keys.s = true;
              if (key === 'd' || key === 'arrowright') keys.d = true;
              if (key === 'e' || key === 'enter') keys.a_button = true;
              if (key === ' ' || key === 'shift') keys.b_button = true;
            };

            const handleKeyUp = (e) => {
              const key = e.key.toLowerCase();
              if (key === 'w' || key === 'arrowup') keys.w = false;
              if (key === 'a' || key === 'arrowleft') keys.a = false;
              if (key === 's' || key === 'arrowdown') keys.s = false;
              if (key === 'd' || key === 'arrowright') keys.d = false;
              if (key === 'e' || key === 'enter') keys.a_button = false;
              if (key === ' ' || key === 'shift') keys.b_button = false;
            };

            window.addEventListener('keydown', handleKeyDown);
            window.addEventListener('keyup', handleKeyUp);

            const clock = new THREE.Clock();
            let standing = false;
            let currentPlayerPos = { x: 8, z: 8 };

            const animate = () => {
              requestAnimationFrame(animate);
              const time = clock.getElapsedTime();

              danceFloorTiles.forEach((tile) => {
                const intensity = 0.3 + Math.sin(time * 2 + tile.phase) * 0.3;
                tile.mesh.material.emissiveIntensity = Math.max(0.1, intensity);
              });

              smokeParticles.forEach(particle => {
                particle.mesh.position.x += particle.velocity.x;
                particle.mesh.position.y += particle.velocity.y;
                particle.mesh.position.z += particle.velocity.z;

                if (particle.mesh.position.y > 4) {
                  particle.mesh.position.y = 0;
                  particle.mesh.position.x = -6 + Math.random() * 4;
                  particle.mesh.position.z = -6 + Math.random() * 4;
                }
              });

              const atTable = Math.abs(currentPlayerPos.x - 8) < 1 && Math.abs(currentPlayerPos.z - 8) < 1;
              const nearBathroomGuy = Math.abs(currentPlayerPos.x - (-1)) < 1 && Math.abs(currentPlayerPos.z - (-8)) < 1.5;

              if (keys.a_button) {
                keys.a_button = false;
                if (atTable && !standing) {
                  setDialogue("I love this song!");
                  setTimeout(() => setDialogue(null), 2000);
                }
              }

              if (keys.b_button) {
                keys.b_button = false;
                if (atTable && !standing) {
                  standing = true;
                  setIsStanding(true);
                } else if (nearBathroomGuy && standing) {
                  setDialogue("...");
                  setTimeout(() => setDialogue(null), 2000);
                }
              }

              if (standing) {
                const speed = 0.1;
                let dx = 0, dz = 0;

                if (keys.w) dz -= speed;
                if (keys.s) dz += speed;
                if (keys.a) dx -= speed;
                if (keys.d) dx += speed;

                if (dx !== 0 || dz !== 0) {
                  const newX = currentPlayerPos.x + dx;
                  const newZ = currentPlayerPos.z + dz;

                  if (newX > -9 && newX < 9 && newZ > -9 && newZ < 9) {
                    currentPlayerPos.x = newX;
                    currentPlayerPos.z = newZ;
                    player.position.x = newX;
                    player.position.z = newZ;
                    playerHead.position.x = newX;
                    playerHead.position.z = newZ;
                    setPlayerPos({ x: newX, z: newZ });
                  }
                }
              }

              renderer.render(scene, camera);
            };

            animate();

            return () => {
              window.removeEventListener('keydown', handleKeyDown);
              window.removeEventListener('keyup', handleKeyUp);
              if (containerRef.current && renderer.domElement.parentNode === containerRef.current) {
                containerRef.current.removeChild(renderer.domElement);
              }
              renderer.dispose();
            };
          }, [gameState]);

          return (
            <div style={{ 
              width: '100vw', 
              height: '100vh', 
              margin: 0, 
              padding: 0, 
              overflow: 'hidden',
              background: '#000',
              fontFamily: "'Courier Prime', monospace"
            }}>
              {gameState === 'intro' && (
                <div style={{
                  position: 'fixed',
                  top: 0,
                  left: 0,
                  width: '100vw',
                  height: '100vh',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  background: '#000',
                  color: '#fff',
                  fontSize: '28px',
                  padding: '40px',
                  textAlign: 'center',
                  letterSpacing: '2px',
                  zIndex: 2000
                }}>
                  <div style={{
                    maxWidth: '800px',
                    borderLeft: '3px solid #ff8800',
                    paddingLeft: '30px'
                  }}>
                    {titleText}
                    <span style={{
                      display: 'inline-block',
                      width: '12px',
                      height: '28px',
                      background: '#ff8800',
                      marginLeft: '4px',
                      animation: 'blink 1s infinite',
                      verticalAlign: 'bottom'
                    }}></span>
                  </div>
                </div>
              )}

              <div ref={containerRef} style={{ width: '100%', height: '100%' }} />

              {gameState === 'playing' && (
                <>
                  <div style={{
                    position: 'absolute',
                    top: '20px',
                    left: '20px',
                    color: '#ff8800',
                    fontSize: '14px',
                    textShadow: '0 0 10px rgba(255, 136, 0, 0.8), 2px 2px 4px rgba(0,0,0,0.8)',
                    letterSpacing: '1px',
                    lineHeight: '1.6',
                    background: 'rgba(0,0,0,0.6)',
                    padding: '15px 20px',
                    borderLeft: '3px solid #ff8800',
                    backdropFilter: 'blur(5px)'
                  }}>
                    <div style={{ fontSize: '18px', marginBottom: '10px', fontWeight: 'bold' }}>
                      NIGHTCLUB • LITTLE ITALY
                    </div>
                    <div style={{ fontSize: '12px', opacity: 0.8 }}>
                      SUMMER 1979 • 11:54 PM
                    </div>
                  </div>

                  <div style={{
                    position: 'absolute',
                    bottom: '20px',
                    right: '20px',
                    color: '#ff8800',
                    fontSize: '13px',
                    textAlign: 'right',
                    background: 'rgba(0,0,0,0.7)',
                    padding: '15px 20px',
                    borderRight: '3px solid #ff8800',
                    backdropFilter: 'blur(5px)',
                    lineHeight: '1.8'
                  }}>
                    <div style={{ marginBottom: '8px' }}>
                      <span style={{ opacity: 0.6 }}>MOVE:</span> WASD / ARROWS
                    </div>
                    <div style={{ marginBottom: '8px' }}>
                      <span style={{ opacity: 0.6 }}>INTERACT:</span> E / ENTER
                    </div>
                    <div>
                      <span style={{ opacity: 0.6 }}>ACTION:</span> SPACE / SHIFT
                    </div>
                  </div>

                  <div style={{
                    position: 'absolute',
                    top: '20px',
                    right: '20px',
                    color: isStanding ? '#00ff00' : '#ff8800',
                    fontSize: '12px',
                    background: 'rgba(0,0,0,0.7)',
                    padding: '10px 15px',
                    borderRight: '3px solid ' + (isStanding ? '#00ff00' : '#ff8800'),
                    backdropFilter: 'blur(5px)'
                  }}>
                    {isStanding ? 'STANDING' : 'SEATED'}
                  </div>

                  {dialogue && (
                    <div style={{
                      position: 'absolute',
                      bottom: '100px',
                      left: '50%',
                      transform: 'translateX(-50%)',
                      background: 'rgba(0, 0, 0, 0.9)',
                      color: '#fff',
                      padding: '20px 40px',
                      fontSize: '18px',
                      borderTop: '2px solid #ff8800',
                      borderBottom: '2px solid #ff8800',
                      minWidth: '400px',
                      textAlign: 'center',
                      letterSpacing: '1px',
                      animation: 'slideUp 0.3s ease-out',
                      backdropFilter: 'blur(10px)'
                    }}>
                      {dialogue}
                    </div>
                  )}

                  <div style={{
                    position: 'absolute',
                    top: 0,
                    left: 0,
                    width: '100%',
                    height: '100%',
                    pointerEvents: 'none',
                    background: 'url("data:image/svg+xml,%3Csvg viewBox=\'0 0 200 200\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cfilter id=\'noiseFilter\'%3E%3CfeTurbulence type=\'fractalNoise\' baseFrequency=\'6.5\' numOctaves=\'3\' stitchTiles=\'stitch\'/%3E%3C/filter%3E%3Crect width=\'100%25\' height=\'100%25\' filter=\'url(%23noiseFilter)\'/%3E%3C/svg%3E")',
                    opacity: 0.08,
                    mixBlendMode: 'overlay'
                  }} />

                  <div style={{
                    position: 'absolute',
                    top: 0,
                    left: 0,
                    width: '100%',
                    height: '100%',
                    pointerEvents: 'none',
                    background: 'radial-gradient(circle, transparent 40%, rgba(0,0,0,0.6) 100%)'
                  }} />
                </>
              )}

              <style>{`
                @keyframes fadeIn {
                  from { opacity: 0; }
                  to { opacity: 1; }
                }
                @keyframes blink {
                  0%, 49% { opacity: 1; }
                  50%, 100% { opacity: 0; }
                }
                @keyframes slideUp {
                  from { 
                    transform: translateX(-50%) translateY(20px);
                    opacity: 0;
                  }
                  to { 
                    transform: translateX(-50%) translateY(0);
                    opacity: 1;
                  }
                }
              `}</style>
            </div>
          );
        };

        // Initialize game immediately so React component is ready
        const gameContainer = document.getElementById('game-container');
        const root = ReactDOM.createRoot(gameContainer);
        
        // Start Game Button Handler
        document.getElementById('start-button').addEventListener('click', () => {
          const landingScreen = document.getElementById('landing-screen');
          
          landingScreen.classList.add('fade-out');
          
          setTimeout(() => {
            landingScreen.style.display = 'none';
            gameContainer.classList.add('active');
            
            // Render React component which will start with intro
            root.render(<DiscoDetectiveGame />);
          }, 1000);
        });
    </script>
</body>
</html>

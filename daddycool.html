<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daddy Cool - A 70s Detective Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier Prime', monospace;
            background: #000;
            color: #fff;
            overflow: hidden;
        }

        #landing-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 0, 102, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 255, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(255, 255, 0, 0.1) 0%, transparent 60%),
                #000;
            z-index: 1000;
            transition: opacity 1s ease-out;
        }

        #landing-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .game-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: clamp(80px, 15vw, 220px);
            letter-spacing: 20px;
            color: #fff;
            text-shadow: 
                0 0 10px #ff8800,
                0 0 20px #ff8800,
                0 0 30px #ff8800,
                0 0 40px #ff6600,
                0 0 70px #ff6600,
                0 0 80px #ff6600,
                0 0 100px #ff6600,
                0 0 150px #ff6600;
            animation: neonPulse 2s ease-in-out infinite;
            margin-bottom: 80px;
            text-align: center;
        }

        .start-button {
            font-family: 'Bebas Neue', sans-serif;
            font-size: clamp(24px, 3vw, 36px);
            letter-spacing: 6px;
            padding: 20px 60px;
            background: linear-gradient(135deg, #ff0066 0%, #ff8800 100%);
            border: 3px solid #ff8800;
            color: #fff;
            cursor: pointer;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            box-shadow: 0 0 20px rgba(255, 136, 0, 0.6);
            transition: all 0.3s ease;
        }

        .start-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 40px rgba(255, 136, 0, 0.9);
        }

        .credits {
            position: absolute;
            bottom: 40px;
            font-size: 14px;
            letter-spacing: 2px;
            color: #ff8800;
            opacity: 0.6;
        }

        #intro-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: none;
            align-items: center;
            justify-content: center;
            background: #000;
            z-index: 900;
        }

        #intro-screen.active {
            display: flex;
        }

        .intro-text {
            max-width: 800px;
            border-left: 3px solid #ff8800;
            padding-left: 30px;
            color: #fff;
            font-size: 28px;
            letter-spacing: 2px;
        }

        .cursor {
            display: inline-block;
            width: 12px;
            height: 28px;
            background: #ff8800;
            margin-left: 4px;
            vertical-align: bottom;
            animation: blink 1s infinite;
        }

        #game-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: none;
            z-index: 800;
        }

        #game-screen.active {
            display: block;
        }

        .hud {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #ff8800;
            font-size: 14px;
            background: rgba(0,0,0,0.6);
            padding: 15px 20px;
            border-left: 3px solid #ff8800;
            z-index: 10;
        }

        .controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            color: #ff8800;
            font-size: 13px;
            text-align: right;
            background: rgba(0,0,0,0.7);
            padding: 15px 20px;
            border-right: 3px solid #ff8800;
            z-index: 10;
        }

        .status {
            position: fixed;
            top: 20px;
            right: 20px;
            font-size: 12px;
            background: rgba(0,0,0,0.7);
            padding: 10px 15px;
            z-index: 10;
        }

        .dialogue-box {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: #fff;
            padding: 20px 40px;
            font-size: 18px;
            border-top: 2px solid #ff8800;
            border-bottom: 2px solid #ff8800;
            min-width: 400px;
            text-align: center;
            display: none;
            z-index: 100;
        }

        .dialogue-box.active {
            display: block;
        }

        @keyframes neonPulse {
            0%, 100% {
                text-shadow: 
                    0 0 10px #ff8800,
                    0 0 20px #ff8800,
                    0 0 30px #ff8800,
                    0 0 40px #ff6600,
                    0 0 70px #ff6600,
                    0 0 80px #ff6600,
                    0 0 100px #ff6600,
                    0 0 150px #ff6600;
            }
            50% {
                text-shadow: 
                    0 0 5px #ff8800,
                    0 0 10px #ff8800,
                    0 0 15px #ff8800,
                    0 0 20px #ff6600,
                    0 0 35px #ff6600,
                    0 0 40px #ff6600,
                    0 0 50px #ff6600,
                    0 0 75px #ff6600;
            }
        }

        @keyframes blink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }
    </style>
</head>
<body>
    <!-- Landing Screen -->
    <div id="landing-screen">
        <h1 class="game-title">DADDY COOL</h1>
        <button class="start-button" onclick="startGame()">PRESS START</button>
        <div class="credits">LITTLE ITALY • SUMMER 1979</div>
    </div>

    <!-- Intro Screen (Typewriter) -->
    <div id="intro-screen">
        <div class="intro-text">
            <span id="typewriter-text"></span>
            <span class="cursor"></span>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="game-screen">
        <div id="game-canvas"></div>
        
        <div class="hud">
            <div style="font-size: 18px; margin-bottom: 10px; font-weight: bold;">
                NIGHTCLUB • LITTLE ITALY
            </div>
            <div style="font-size: 12px; opacity: 0.8;">
                SUMMER 1979 • 11:54 PM
            </div>
        </div>

        <div class="controls">
            <div style="margin-bottom: 8px;">
                <span style="opacity: 0.6;">MOVE:</span> WASD / ARROWS
            </div>
            <div style="margin-bottom: 8px;">
                <span style="opacity: 0.6;">INTERACT:</span> E / ENTER
            </div>
            <div>
                <span style="opacity: 0.6;">ACTION:</span> SPACE / SHIFT
            </div>
        </div>

        <div class="status" id="status">SEATED</div>
        <div class="dialogue-box" id="dialogue"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let audio = null;
        let scene, camera, renderer;
        let player, playerHead;
        let isStanding = false;
        let currentPlayerPos = { x: 8, z: 8 };
        const keys = { w: false, a: false, s: false, d: false, interact: false, action: false };

        // Start game flow
        function startGame() {
            console.log('Starting game...');
            const landingScreen = document.getElementById('landing-screen');
            const introScreen = document.getElementById('intro-screen');
            
            // Fade out landing, show intro
            landingScreen.classList.add('hidden');
            
            setTimeout(() => {
                landingScreen.style.display = 'none';
                introScreen.classList.add('active');
                startTypewriter();
            }, 1000);
        }

        // Typewriter effect
        function startTypewriter() {
            console.log('Starting typewriter...');
            const text = "Nightclub interior.  Little Italy.  Summer 1979.  11:54 PM.";
            const element = document.getElementById('typewriter-text');
            let index = 0;

            // Start music
            audio = new Audio('/music/nightclub.mp3');
            audio.loop = true;
            audio.volume = 0.6;
            audio.play().catch(e => console.log('Audio play failed:', e));

            const interval = setInterval(() => {
                if (index < text.length) {
                    element.textContent = text.slice(0, index + 1);
                    index++;
                } else {
                    clearInterval(interval);
                    setTimeout(() => {
                        document.getElementById('intro-screen').classList.remove('active');
                        document.getElementById('intro-screen').style.display = 'none';
                        document.getElementById('game-screen').classList.add('active');
                        initGame();
                    }, 1500);
                }
            }, 50);
        }

        // Initialize 3D game
        function initGame() {
            console.log('Initializing 3D scene...');
            
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a0a0a);
            scene.fog = new THREE.Fog(0x0a0a0a, 15, 35);

            camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 100);
            camera.position.set(0, 18, 22);
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('game-canvas').appendChild(renderer.domElement);

            // Lights
            const ambientLight = new THREE.AmbientLight(0x331111, 0.3);
            scene.add(ambientLight);

            const spotLights = [
                { color: 0xff0066, pos: [-6, 8, -6], target: [-6, 0, -6] },
                { color: 0x00ffff, pos: [-3, 8, -6], target: [-3, 0, -6] },
                { color: 0xffff00, pos: [-6, 8, -3], target: [-6, 0, -3] },
                { color: 0x0066ff, pos: [-3, 8, -3], target: [-3, 0, -3] },
            ];

            spotLights.forEach(light => {
                const spotLight = new THREE.SpotLight(light.color, 2, 20, Math.PI / 6, 0.5);
                spotLight.position.set(...light.pos);
                spotLight.target.position.set(...light.target);
                spotLight.castShadow = true;
                scene.add(spotLight);
                scene.add(spotLight.target);
            });

            const tableLight = new THREE.PointLight(0xff8833, 1, 15);
            tableLight.position.set(4, 6, 2);
            scene.add(tableLight);

            // Floor
            const floor = new THREE.Mesh(
                new THREE.PlaneGeometry(30, 30),
                new THREE.MeshStandardMaterial({ color: 0x1a0a0a, roughness: 0.8 })
            );
            floor.rotation.x = -Math.PI / 2;
            floor.position.y = -0.01;
            floor.receiveShadow = true;
            scene.add(floor);

            // Dance floor tiles
            const danceFloorTiles = [];
            const tileColors = [0xff0000, 0x0000ff, 0xffff00, 0xffffff];
            for (let x = 0; x < 4; x++) {
                for (let z = 0; z < 4; z++) {
                    const tile = new THREE.Mesh(
                        new THREE.BoxGeometry(1.8, 0.15, 1.8),
                        new THREE.MeshStandardMaterial({
                            color: tileColors[(x + z) % 4],
                            emissive: tileColors[(x + z) % 4],
                            emissiveIntensity: 0.5,
                            metalness: 0.3,
                            roughness: 0.4
                        })
                    );
                    tile.position.set(-7.5 + x * 2, 0, -7.5 + z * 2);
                    tile.castShadow = true;
                    scene.add(tile);
                    danceFloorTiles.push({ mesh: tile, phase: Math.random() * Math.PI * 2 });
                }
            }

            // Platform
            const platform = new THREE.Mesh(
                new THREE.BoxGeometry(8, 0.3, 10),
                new THREE.MeshStandardMaterial({ color: 0x2a1515, roughness: 0.9 })
            );
            platform.position.set(5, 0.15, 0);
            scene.add(platform);

            // Carpet
            const carpet = new THREE.Mesh(
                new THREE.PlaneGeometry(7.5, 9.5),
                new THREE.MeshStandardMaterial({ color: 0x8b0000, roughness: 0.95 })
            );
            carpet.rotation.x = -Math.PI / 2;
            carpet.position.set(5, 0.31, 0);
            scene.add(carpet);

            // Tables with couples
            const tables = [
                { pos: [4, 0.3, -3], isPlayer: false },
                { pos: [4, 0.3, 0], isPlayer: false },
                { pos: [4, 0.3, 3], isPlayer: false },
                { pos: [7, 0.3, 6], isPlayer: true },
            ];

            tables.forEach((tableData) => {
                const tableTop = new THREE.Mesh(
                    new THREE.CylinderGeometry(0.8, 0.8, 0.05, 16),
                    new THREE.MeshStandardMaterial({ color: 0x000000, metalness: 0.5 })
                );
                tableTop.position.set(tableData.pos[0], tableData.pos[1] + 0.7, tableData.pos[2]);
                scene.add(tableTop);

                const tablecloth = new THREE.Mesh(
                    new THREE.CylinderGeometry(0.85, 0.7, 0.7, 16),
                    new THREE.MeshStandardMaterial({ color: 0xcc0000, roughness: 0.8 })
                );
                tablecloth.position.set(tableData.pos[0], tableData.pos[1] + 0.35, tableData.pos[2]);
                scene.add(tablecloth);

                if (!tableData.isPlayer) {
                    // Lady
                    const ladyBody = new THREE.Mesh(
                        new THREE.CylinderGeometry(0.15, 0.25, 0.8, 8),
                        new THREE.MeshStandardMaterial({ 
                            color: [0xff1493, 0x9400d3, 0x00ced1][Math.floor(Math.random() * 3)]
                        })
                    );
                    ladyBody.position.set(tableData.pos[0] - 0.5, tableData.pos[1] + 0.7, tableData.pos[2]);
                    scene.add(ladyBody);

                    const ladyHead = new THREE.Mesh(
                        new THREE.SphereGeometry(0.15, 8, 8),
                        new THREE.MeshStandardMaterial({ color: 0xffdbac })
                    );
                    ladyHead.position.set(tableData.pos[0] - 0.5, tableData.pos[1] + 1.25, tableData.pos[2]);
                    scene.add(ladyHead);

                    // Man
                    const manBody = new THREE.Mesh(
                        new THREE.CylinderGeometry(0.2, 0.22, 0.9, 8),
                        new THREE.MeshStandardMaterial({ 
                            color: [0x000000, 0x4169e1, 0x8b0000][Math.floor(Math.random() * 3)]
                        })
                    );
                    manBody.position.set(tableData.pos[0] + 0.5, tableData.pos[1] + 0.75, tableData.pos[2]);
                    scene.add(manBody);

                    const manHead = new THREE.Mesh(
                        new THREE.SphereGeometry(0.15, 8, 8),
                        new THREE.MeshStandardMaterial({ color: 0xffdbac })
                    );
                    manHead.position.set(tableData.pos[0] + 0.5, tableData.pos[1] + 1.3, tableData.pos[2]);
                    scene.add(manHead);
                }
            });

            // Player
            player = new THREE.Mesh(
                new THREE.CapsuleGeometry(0.2, 0.6, 8, 16),
                new THREE.MeshStandardMaterial({ color: 0x2a2a2a })
            );
            player.position.set(8, 0.7, 8);
            scene.add(player);

            playerHead = new THREE.Mesh(
                new THREE.SphereGeometry(0.15, 8, 8),
                new THREE.MeshStandardMaterial({ color: 0xffdbac })
            );
            playerHead.position.set(8, 1.15, 8);
            scene.add(playerHead);

            // Date
            const dateBody = new THREE.Mesh(
                new THREE.CylinderGeometry(0.15, 0.25, 0.8, 8),
                new THREE.MeshStandardMaterial({ color: 0xff69b4 })
            );
            dateBody.position.set(6.5, 0.7, 7.5);
            scene.add(dateBody);

            const dateHead = new THREE.Mesh(
                new THREE.SphereGeometry(0.15, 8, 8),
                new THREE.MeshStandardMaterial({ color: 0xffdbac })
            );
            dateHead.position.set(6.5, 1.25, 7.5);
            scene.add(dateHead);

            // Bathroom guy
            const bathroomGuy = new THREE.Group();
            const guyBody = new THREE.Mesh(
                new THREE.CylinderGeometry(0.2, 0.22, 0.9, 8),
                new THREE.MeshStandardMaterial({ color: 0x000000 })
            );
            bathroomGuy.add(guyBody);

            const guyHead = new THREE.Mesh(
                new THREE.SphereGeometry(0.15, 8, 8),
                new THREE.MeshStandardMaterial({ color: 0xffdbac })
            );
            guyHead.position.y = 0.55;
            bathroomGuy.add(guyHead);

            const sunglasses = new THREE.Mesh(
                new THREE.BoxGeometry(0.25, 0.05, 0.15),
                new THREE.MeshStandardMaterial({ color: 0xff8800, metalness: 0.9 })
            );
            sunglasses.position.set(0, 0.55, 0.12);
            bathroomGuy.add(sunglasses);

            bathroomGuy.position.set(-1, 0.75, -8);
            scene.add(bathroomGuy);

            // Smoke
            const smokeParticles = [];
            for (let i = 0; i < 40; i++) {
                const smoke = new THREE.Mesh(
                    new THREE.SphereGeometry(0.3, 8, 8),
                    new THREE.MeshBasicMaterial({ color: 0xaaaaaa, transparent: true, opacity: 0.15 })
                );
                smoke.position.set(-6 + Math.random() * 4, Math.random() * 3, -6 + Math.random() * 4);
                scene.add(smoke);
                smokeParticles.push({
                    mesh: smoke,
                    velocity: { x: (Math.random() - 0.5) * 0.02, y: Math.random() * 0.01, z: (Math.random() - 0.5) * 0.02 }
                });
            }

            // Bar
            const bar = new THREE.Mesh(
                new THREE.BoxGeometry(3, 1.2, 1),
                new THREE.MeshStandardMaterial({ color: 0x4a2511 })
            );
            bar.position.set(-7, 0.6, 8);
            scene.add(bar);

            // Walls
            const backWall = new THREE.Mesh(
                new THREE.BoxGeometry(30, 5, 0.5),
                new THREE.MeshStandardMaterial({ color: 0x1a0505 })
            );
            backWall.position.set(0, 2.5, -10);
            scene.add(backWall);

            const rightWall = new THREE.Mesh(
                new THREE.BoxGeometry(0.5, 5, 30),
                new THREE.MeshStandardMaterial({ color: 0x1a0505 })
            );
            rightWall.position.set(10, 2.5, 0);
            scene.add(rightWall);

            // Input
            window.addEventListener('keydown', (e) => {
                const key = e.key.toLowerCase();
                if (key === 'w' || key === 'arrowup') keys.w = true;
                if (key === 'a' || key === 'arrowleft') keys.a = true;
                if (key === 's' || key === 'arrowdown') keys.s = true;
                if (key === 'd' || key === 'arrowright') keys.d = true;
                if (key === 'e' || key === 'enter') keys.interact = true;
                if (key === ' ' || key === 'shift') keys.action = true;
            });

            window.addEventListener('keyup', (e) => {
                const key = e.key.toLowerCase();
                if (key === 'w' || key === 'arrowup') keys.w = false;
                if (key === 'a' || key === 'arrowleft') keys.a = false;
                if (key === 's' || key === 'arrowdown') keys.s = false;
                if (key === 'd' || key === 'arrowright') keys.d = false;
                if (key === 'e' || key === 'enter') keys.interact = false;
                if (key === ' ' || key === 'shift') keys.action = false;
            });

            // Animation loop
            const clock = new THREE.Clock();
            function animate() {
                requestAnimationFrame(animate);
                const time = clock.getElapsedTime();

                // Animate tiles
                danceFloorTiles.forEach((tile) => {
                    const intensity = 0.3 + Math.sin(time * 2 + tile.phase) * 0.3;
                    tile.mesh.material.emissiveIntensity = Math.max(0.1, intensity);
                });

                // Animate smoke
                smokeParticles.forEach(particle => {
                    particle.mesh.position.x += particle.velocity.x;
                    particle.mesh.position.y += particle.velocity.y;
                    particle.mesh.position.z += particle.velocity.z;

                    if (particle.mesh.position.y > 4) {
                        particle.mesh.position.y = 0;
                        particle.mesh.position.x = -6 + Math.random() * 4;
                        particle.mesh.position.z = -6 + Math.random() * 4;
                    }
                });

                // Game logic
                const atTable = Math.abs(currentPlayerPos.x - 8) < 1 && Math.abs(currentPlayerPos.z - 8) < 1;
                const nearBathroomGuy = Math.abs(currentPlayerPos.x - (-1)) < 1 && Math.abs(currentPlayerPos.z - (-8)) < 1.5;

                if (keys.interact) {
                    keys.interact = false;
                    if (atTable && !isStanding) {
                        showDialogue("I love this song!");
                    }
                }

                if (keys.action) {
                    keys.action = false;
                    if (atTable && !isStanding) {
                        isStanding = true;
                        document.getElementById('status').textContent = 'STANDING';
                        document.getElementById('status').style.color = '#00ff00';
                        document.getElementById('status').style.borderColor = '#00ff00';
                    } else if (nearBathroomGuy && isStanding) {
                        showDialogue("...");
                    }
                }

                // Movement
                if (isStanding) {
                    const speed = 0.1;
                    let dx = 0, dz = 0;

                    if (keys.w) dz -= speed;
                    if (keys.s) dz += speed;
                    if (keys.a) dx -= speed;
                    if (keys.d) dx += speed;

                    if (dx !== 0 || dz !== 0) {
                        const newX = currentPlayerPos.x + dx;
                        const newZ = currentPlayerPos.z + dz;

                        if (newX > -9 && newX < 9 && newZ > -9 && newZ < 9) {
                            currentPlayerPos.x = newX;
                            currentPlayerPos.z = newZ;
                            player.position.x = newX;
                            player.position.z = newZ;
                            playerHead.position.x = newX;
                            playerHead.position.z = newZ;
                        }
                    }
                }

                renderer.render(scene, camera);
            }

            animate();
            console.log('Game running!');
        }

        function showDialogue(text) {
            const dialogue = document.getElementById('dialogue');
            dialogue.textContent = text;
            dialogue.classList.add('active');
            setTimeout(() => {
                dialogue.classList.remove('active');
            }, 2000);
        }
    </script>
</body>
</html>

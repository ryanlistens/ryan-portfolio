<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Daddy Cool</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
        }

        body {
            font-family: 'Courier Prime', monospace;
            background: #000;
            color: #fff;
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }

        #landing-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 0, 102, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 255, 255, 0.15) 0%, transparent 50%),
                #000;
            z-index: 1000;
            transition: opacity 1s ease-out;
        }

        #landing-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .game-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: clamp(60px, 15vw, 180px);
            letter-spacing: 20px;
            color: #fff;
            text-shadow: 
                0 0 10px #ff8800,
                0 0 20px #ff8800,
                0 0 30px #ff8800,
                0 0 40px #ff6600,
                0 0 70px #ff6600;
            animation: neonPulse 2s ease-in-out infinite;
            margin-bottom: 60px;
            text-align: center;
        }

        .start-button {
            font-family: 'Bebas Neue', sans-serif;
            font-size: clamp(20px, 5vw, 32px);
            letter-spacing: 6px;
            padding: 20px 50px;
            background: linear-gradient(135deg, #ff0066 0%, #ff8800 100%);
            border: 3px solid #ff8800;
            color: #fff;
            cursor: pointer;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            box-shadow: 0 0 20px rgba(255, 136, 0, 0.6);
            transition: all 0.3s ease;
            touch-action: manipulation;
        }

        .start-button:active {
            transform: scale(0.95);
        }

        #intro-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: none;
            align-items: center;
            justify-content: center;
            background: #000;
            z-index: 900;
            padding: 20px;
        }

        #intro-screen.active {
            display: flex;
        }

        .intro-text {
            max-width: 90%;
            border-left: 3px solid #ff8800;
            padding-left: 20px;
            color: #fff;
            font-size: clamp(18px, 4vw, 24px);
            letter-spacing: 1px;
        }

        .cursor {
            display: inline-block;
            width: 8px;
            height: 1em;
            background: #ff8800;
            margin-left: 4px;
            vertical-align: bottom;
            animation: blink 1s infinite;
        }

        #game-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: none;
        }

        #game-screen.active {
            display: block;
        }

        #game-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .hud {
            position: fixed;
            top: 10px;
            left: 10px;
            color: #ff8800;
            font-size: 11px;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-left: 3px solid #ff8800;
            z-index: 10;
            pointer-events: none;
        }

        .status {
            position: fixed;
            top: 10px;
            right: 10px;
            font-size: 11px;
            background: rgba(0,0,0,0.7);
            padding: 8px 12px;
            z-index: 10;
            color: #ff8800;
            border-right: 3px solid #ff8800;
            pointer-events: none;
        }

        .dialogue-box {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: #fff;
            padding: 15px 25px;
            font-size: 14px;
            border-top: 2px solid #ff8800;
            border-bottom: 2px solid #ff8800;
            min-width: 200px;
            max-width: 90%;
            text-align: center;
            display: none;
            z-index: 100;
            pointer-events: none;
        }

        .dialogue-box.active {
            display: block;
        }

        /* Mobile Joystick */
        .joystick-container {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 120px;
            height: 120px;
            z-index: 50;
        }

        .joystick-base {
            position: absolute;
            width: 120px;
            height: 120px;
            background: radial-gradient(circle, rgba(255, 136, 0, 0.3), rgba(255, 136, 0, 0.1));
            border: 3px solid rgba(255, 136, 0, 0.5);
            border-radius: 50%;
        }

        .joystick-stick {
            position: absolute;
            width: 50px;
            height: 50px;
            background: radial-gradient(circle, #ff8800, #ff6600);
            border: 2px solid #fff;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 15px rgba(255, 136, 0, 0.6);
            transition: all 0.1s ease;
        }

        /* Action Buttons */
        .action-buttons {
            position: fixed;
            bottom: 30px;
            right: 20px;
            display: flex;
            gap: 15px;
            z-index: 50;
        }

        .action-btn {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #ff0066, #ff8800);
            border: 3px solid #ff8800;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 16px;
            color: #fff;
            box-shadow: 0 0 15px rgba(255, 136, 0, 0.5);
            touch-action: manipulation;
            cursor: pointer;
        }

        .action-btn:active {
            transform: scale(0.9);
            box-shadow: 0 0 25px rgba(255, 136, 0, 0.8);
        }

        @keyframes neonPulse {
            0%, 100% {
                text-shadow: 
                    0 0 10px #ff8800,
                    0 0 20px #ff8800,
                    0 0 30px #ff8800,
                    0 0 40px #ff6600,
                    0 0 70px #ff6600;
            }
            50% {
                text-shadow: 
                    0 0 5px #ff8800,
                    0 0 10px #ff8800,
                    0 0 15px #ff8800,
                    0 0 20px #ff6600,
                    0 0 35px #ff6600;
            }
        }

        @keyframes blink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }
    </style>
</head>
<body>
    <!-- Landing Screen -->
    <div id="landing-screen">
        <h1 class="game-title">DADDY COOL</h1>
        <button class="start-button" id="start-btn">TAP TO START</button>
    </div>

    <!-- Intro Screen -->
    <div id="intro-screen">
        <div class="intro-text">
            <span id="typewriter-text"></span>
            <span class="cursor"></span>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="game-screen">
        <div id="game-canvas"></div>
        
        <div class="hud">
            <div style="font-weight: bold; margin-bottom: 5px;">NIGHTCLUB</div>
            <div style="font-size: 9px; opacity: 0.8;">LITTLE ITALY '79</div>
        </div>

        <div class="status" id="status">SEATED</div>
        <div class="dialogue-box" id="dialogue"></div>

        <!-- Mobile Controls -->
        <div class="joystick-container" id="joystick-container">
            <div class="joystick-base"></div>
            <div class="joystick-stick" id="joystick-stick"></div>
        </div>

        <div class="action-buttons">
            <div class="action-btn" id="interact-btn">
                <span>A</span>
            </div>
            <div class="action-btn" id="action-btn">
                <span>B</span>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let audio = null;
        let scene, camera, renderer;
        let player, playerHead;
        let isStanding = false;
        let currentPlayerPos = { x: 8, z: 8 };
        
        // Joystick state
        let joystickActive = false;
        let joystickDirection = { x: 0, y: 0 };

        // Start button
        document.getElementById('start-btn').addEventListener('click', startGame);

        function startGame() {
            const landingScreen = document.getElementById('landing-screen');
            const introScreen = document.getElementById('intro-screen');
            
            landingScreen.classList.add('hidden');
            
            setTimeout(() => {
                landingScreen.style.display = 'none';
                introScreen.classList.add('active');
                startTypewriter();
            }, 1000);
        }

        function startTypewriter() {
            const text = "Nightclub interior.  Little Italy.  Summer 1979.  11:54 PM.";
            const element = document.getElementById('typewriter-text');
            let index = 0;

            audio = new Audio('/music/nightclub.mp3');
            audio.loop = true;
            audio.volume = 0.6;
            audio.play().catch(e => console.log('Audio autoplay blocked'));

            const interval = setInterval(() => {
                if (index < text.length) {
                    element.textContent = text.slice(0, index + 1);
                    index++;
                } else {
                    clearInterval(interval);
                    setTimeout(() => {
                        document.getElementById('intro-screen').classList.remove('active');
                        document.getElementById('intro-screen').style.display = 'none';
                        document.getElementById('game-screen').classList.add('active');
                        initGame();
                    }, 1500);
                }
            }, 50);
        }

        function initGame() {
            console.log('Initializing 3D scene...');
            
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a0a0a);
            scene.fog = new THREE.Fog(0x0a0a0a, 15, 35);

            camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 100);
            camera.position.set(0, 18, 22);
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.getElementById('game-canvas').appendChild(renderer.domElement);

            // Lights
            const ambientLight = new THREE.AmbientLight(0x331111, 0.3);
            scene.add(ambientLight);

            const spotLights = [
                { color: 0xff0066, pos: [-6, 8, -6], target: [-6, 0, -6] },
                { color: 0x00ffff, pos: [-3, 8, -6], target: [-3, 0, -6] },
                { color: 0xffff00, pos: [-6, 8, -3], target: [-6, 0, -3] },
                { color: 0x0066ff, pos: [-3, 8, -3], target: [-3, 0, -3] },
            ];

            spotLights.forEach(light => {
                const spotLight = new THREE.SpotLight(light.color, 2, 20, Math.PI / 6, 0.5);
                spotLight.position.set(...light.pos);
                spotLight.target.position.set(...light.target);
                spotLight.castShadow = true;
                scene.add(spotLight);
                scene.add(spotLight.target);
            });

            const tableLight = new THREE.PointLight(0xff8833, 1, 15);
            tableLight.position.set(4, 6, 2);
            scene.add(tableLight);

            // Floor
            const floor = new THREE.Mesh(
                new THREE.PlaneGeometry(30, 30),
                new THREE.MeshStandardMaterial({ color: 0x1a0a0a, roughness: 0.8 })
            );
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);

            // Dance floor tiles
            const danceFloorTiles = [];
            const tileColors = [0xff0000, 0x0000ff, 0xffff00, 0xffffff];
            for (let x = 0; x < 4; x++) {
                for (let z = 0; z < 4; z++) {
                    const tile = new THREE.Mesh(
                        new THREE.BoxGeometry(1.8, 0.15, 1.8),
                        new THREE.MeshStandardMaterial({
                            color: tileColors[(x + z) % 4],
                            emissive: tileColors[(x + z) % 4],
                            emissiveIntensity: 0.5
                        })
                    );
                    tile.position.set(-7.5 + x * 2, 0, -7.5 + z * 2);
                    tile.castShadow = true;
                    scene.add(tile);
                    danceFloorTiles.push({ mesh: tile, phase: Math.random() * Math.PI * 2 });
                }
            }

            // Platform
            const platform = new THREE.Mesh(
                new THREE.BoxGeometry(8, 0.3, 10),
                new THREE.MeshStandardMaterial({ color: 0x2a1515 })
            );
            platform.position.set(5, 0.15, 0);
            scene.add(platform);

            // Carpet
            const carpet = new THREE.Mesh(
                new THREE.PlaneGeometry(7.5, 9.5),
                new THREE.MeshStandardMaterial({ color: 0x8b0000 })
            );
            carpet.rotation.x = -Math.PI / 2;
            carpet.position.set(5, 0.31, 0);
            scene.add(carpet);

            // Tables
            const tables = [
                { pos: [4, 0.3, -3] },
                { pos: [4, 0.3, 0] },
                { pos: [4, 0.3, 3] },
                { pos: [7, 0.3, 6] },
            ];

            tables.forEach((tableData, idx) => {
                const tableTop = new THREE.Mesh(
                    new THREE.CylinderGeometry(0.8, 0.8, 0.05, 16),
                    new THREE.MeshStandardMaterial({ color: 0x000000 })
                );
                tableTop.position.set(tableData.pos[0], tableData.pos[1] + 0.7, tableData.pos[2]);
                scene.add(tableTop);

                const tablecloth = new THREE.Mesh(
                    new THREE.CylinderGeometry(0.85, 0.7, 0.7, 16),
                    new THREE.MeshStandardMaterial({ color: 0xcc0000 })
                );
                tablecloth.position.set(tableData.pos[0], tableData.pos[1] + 0.35, tableData.pos[2]);
                scene.add(tablecloth);

                if (idx < 3) {
                    const ladyBody = new THREE.Mesh(
                        new THREE.CylinderGeometry(0.15, 0.25, 0.8, 8),
                        new THREE.MeshStandardMaterial({ color: [0xff1493, 0x9400d3, 0x00ced1][idx] })
                    );
                    ladyBody.position.set(tableData.pos[0] - 0.5, tableData.pos[1] + 0.7, tableData.pos[2]);
                    scene.add(ladyBody);

                    const ladyHead = new THREE.Mesh(
                        new THREE.SphereGeometry(0.15, 8, 8),
                        new THREE.MeshStandardMaterial({ color: 0xffdbac })
                    );
                    ladyHead.position.set(tableData.pos[0] - 0.5, tableData.pos[1] + 1.25, tableData.pos[2]);
                    scene.add(ladyHead);

                    const manBody = new THREE.Mesh(
                        new THREE.CylinderGeometry(0.2, 0.22, 0.9, 8),
                        new THREE.MeshStandardMaterial({ color: [0x000000, 0x4169e1, 0x8b0000][idx] })
                    );
                    manBody.position.set(tableData.pos[0] + 0.5, tableData.pos[1] + 0.75, tableData.pos[2]);
                    scene.add(manBody);

                    const manHead = new THREE.Mesh(
                        new THREE.SphereGeometry(0.15, 8, 8),
                        new THREE.MeshStandardMaterial({ color: 0xffdbac })
                    );
                    manHead.position.set(tableData.pos[0] + 0.5, tableData.pos[1] + 1.3, tableData.pos[2]);
                    scene.add(manHead);
                }
            });

            // Player
            player = new THREE.Mesh(
                new THREE.CapsuleGeometry(0.2, 0.6, 8, 16),
                new THREE.MeshStandardMaterial({ color: 0x2a2a2a })
            );
            player.position.set(8, 0.7, 8);
            scene.add(player);

            playerHead = new THREE.Mesh(
                new THREE.SphereGeometry(0.15, 8, 8),
                new THREE.MeshStandardMaterial({ color: 0xffdbac })
            );
            playerHead.position.set(8, 1.15, 8);
            scene.add(playerHead);

            // Date
            const dateBody = new THREE.Mesh(
                new THREE.CylinderGeometry(0.15, 0.25, 0.8, 8),
                new THREE.MeshStandardMaterial({ color: 0xff69b4 })
            );
            dateBody.position.set(6.5, 0.7, 7.5);
            scene.add(dateBody);

            const dateHead = new THREE.Mesh(
                new THREE.SphereGeometry(0.15, 8, 8),
                new THREE.MeshStandardMaterial({ color: 0xffdbac })
            );
            dateHead.position.set(6.5, 1.25, 7.5);
            scene.add(dateHead);

            // Bathroom guy
            const bathroomGuy = new THREE.Group();
            const guyBody = new THREE.Mesh(
                new THREE.CylinderGeometry(0.2, 0.22, 0.9, 8),
                new THREE.MeshStandardMaterial({ color: 0x000000 })
            );
            bathroomGuy.add(guyBody);

            const guyHead = new THREE.Mesh(
                new THREE.SphereGeometry(0.15, 8, 8),
                new THREE.MeshStandardMaterial({ color: 0xffdbac })
            );
            guyHead.position.y = 0.55;
            bathroomGuy.add(guyHead);

            const sunglasses = new THREE.Mesh(
                new THREE.BoxGeometry(0.25, 0.05, 0.15),
                new THREE.MeshStandardMaterial({ color: 0xff8800 })
            );
            sunglasses.position.set(0, 0.55, 0.12);
            bathroomGuy.add(sunglasses);

            bathroomGuy.position.set(-1, 0.75, -8);
            scene.add(bathroomGuy);

            // Smoke
            const smokeParticles = [];
            for (let i = 0; i < 30; i++) {
                const smoke = new THREE.Mesh(
                    new THREE.SphereGeometry(0.3, 8, 8),
                    new THREE.MeshBasicMaterial({ color: 0xaaaaaa, transparent: true, opacity: 0.15 })
                );
                smoke.position.set(-6 + Math.random() * 4, Math.random() * 3, -6 + Math.random() * 4);
                scene.add(smoke);
                smokeParticles.push({
                    mesh: smoke,
                    velocity: { x: (Math.random() - 0.5) * 0.02, y: Math.random() * 0.01, z: (Math.random() - 0.5) * 0.02 }
                });
            }

            // Bar
            const bar = new THREE.Mesh(
                new THREE.BoxGeometry(3, 1.2, 1),
                new THREE.MeshStandardMaterial({ color: 0x4a2511 })
            );
            bar.position.set(-7, 0.6, 8);
            scene.add(bar);

            // Walls
            const backWall = new THREE.Mesh(
                new THREE.BoxGeometry(30, 5, 0.5),
                new THREE.MeshStandardMaterial({ color: 0x1a0505 })
            );
            backWall.position.set(0, 2.5, -10);
            scene.add(backWall);

            const rightWall = new THREE.Mesh(
                new THREE.BoxGeometry(0.5, 5, 30),
                new THREE.MeshStandardMaterial({ color: 0x1a0505 })
            );
            rightWall.position.set(10, 2.5, 0);
            scene.add(rightWall);

            // Touch controls
            setupTouchControls();

            // Animation loop
            const clock = new THREE.Clock();
            function animate() {
                requestAnimationFrame(animate);
                const time = clock.getElapsedTime();

                danceFloorTiles.forEach((tile) => {
                    const intensity = 0.3 + Math.sin(time * 2 + tile.phase) * 0.3;
                    tile.mesh.material.emissiveIntensity = Math.max(0.1, intensity);
                });

                smokeParticles.forEach(particle => {
                    particle.mesh.position.x += particle.velocity.x;
                    particle.mesh.position.y += particle.velocity.y;
                    particle.mesh.position.z += particle.velocity.z;

                    if (particle.mesh.position.y > 4) {
                        particle.mesh.position.y = 0;
                        particle.mesh.position.x = -6 + Math.random() * 4;
                        particle.mesh.position.z = -6 + Math.random() * 4;
                    }
                });

                if (isStanding && (joystickDirection.x !== 0 || joystickDirection.y !== 0)) {
                    const speed = 0.08;
                    const newX = currentPlayerPos.x + joystickDirection.x * speed;
                    const newZ = currentPlayerPos.z - joystickDirection.y * speed;

                    if (newX > -9 && newX < 9 && newZ > -9 && newZ < 9) {
                        currentPlayerPos.x = newX;
                        currentPlayerPos.z = newZ;
                        player.position.x = newX;
                        player.position.z = newZ;
                        playerHead.position.x = newX;
                        playerHead.position.z = newZ;
                    }
                }

                renderer.render(scene, camera);
            }

            animate();
        }

        function setupTouchControls() {
            const joystickContainer = document.getElementById('joystick-container');
            const joystickStick = document.getElementById('joystick-stick');
            const interactBtn = document.getElementById('interact-btn');
            const actionBtn = document.getElementById('action-btn');

            // Joystick
            joystickContainer.addEventListener('touchstart', handleJoystickStart);
            joystickContainer.addEventListener('touchmove', handleJoystickMove);
            joystickContainer.addEventListener('touchend', handleJoystickEnd);

            function handleJoystickStart(e) {
                e.preventDefault();
                joystickActive = true;
            }

            function handleJoystickMove(e) {
                if (!joystickActive) return;
                e.preventDefault();

                const touch = e.touches[0];
                const rect = joystickContainer.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                
                let deltaX = touch.clientX - centerX;
                let deltaY = touch.clientY - centerY;
                
                const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                const maxDistance = 35;
                
                if (distance > maxDistance) {
                    deltaX = (deltaX / distance) * maxDistance;
                    deltaY = (deltaY / distance) * maxDistance;
                }
                
                joystickStick.style.transform = `translate(calc(-50% + ${deltaX}px), calc(-50% + ${deltaY}px))`;
                
                joystickDirection.x = deltaX / maxDistance;
                joystickDirection.y = deltaY / maxDistance;
            }

            function handleJoystickEnd(e) {
                e.preventDefault();
                joystickActive = false;
                joystickStick.style.transform = 'translate(-50%, -50%)';
                joystickDirection.x = 0;
                joystickDirection.y = 0;
            }

            // Interact button (A)
            interactBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const atTable = Math.abs(currentPlayerPos.x - 8) < 1 && Math.abs(currentPlayerPos.z - 8) < 1;
                if (atTable && !isStanding) {
                    showDialogue("I love this song!");
                }
            });

            // Action button (B)
            actionBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const atTable = Math.abs(currentPlayerPos.x - 8) < 1 && Math.abs(currentPlayerPos.z - 8) < 1;
                const nearBathroomGuy = Math.abs(currentPlayerPos.x - (-1)) < 1 && Math.abs(currentPlayerPos.z - (-8)) < 1.5;

                if (atTable && !isStanding) {
                    isStanding = true;
                    document.getElementById('status').textContent = 'STANDING';
                    document.getElementById('status').style.color = '#00ff00';
                    document.getElementById('status').style.borderRightColor = '#00ff00';
                } else if (nearBathroomGuy && isStanding) {
                    showDialogue("...");
                }
            });
        }

        function showDialogue(text) {
            const dialogue = document.getElementById('dialogue');
            dialogue.textContent = text;
            dialogue.classList.add('active');
            setTimeout(() => {
                dialogue.classList.remove('active');
            }, 2000);
        }

        // Handle resize
        window.addEventListener('resize', () => {
            if (camera && renderer) {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }
        });
    </script>
</body>
</html>

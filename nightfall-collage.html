<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>NIGHTFALL - A Collage Noir</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Special+Elite&family=Playfair+Display:wght@700&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: #0a0908;
            overflow: hidden;
            font-family: 'Special Elite', monospace;
            width: 100vw;
            height: 100vh;
            touch-action: none;
        }

        #game {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        /* =============================================
           TERRY GILLIAM ANIMATION SYSTEM
        ============================================= */
        @keyframes gilliam-idle {
            0%, 100% { transform: rotate(0deg) translateY(0); }
            15% { transform: rotate(0.8deg) translateY(-2px); }
            30% { transform: rotate(-0.5deg) translateY(0); }
            60% { transform: rotate(-0.8deg) translateY(1px); }
        }

        @keyframes gilliam-walk {
            0%, 100% { transform: rotate(-2deg) translateY(0); }
            25% { transform: rotate(2deg) translateY(-4px); }
            50% { transform: rotate(-2deg) translateY(0); }
            75% { transform: rotate(2deg) translateY(-4px); }
        }

        @keyframes gilliam-talk {
            0%, 100% { transform: rotate(0deg) scale(1); }
            20% { transform: rotate(-1.5deg) scale(1.02); }
            40% { transform: rotate(1.5deg) scale(0.98); }
            60% { transform: rotate(-1deg) scale(1.01); }
            80% { transform: rotate(1deg) scale(0.99); }
        }

        @keyframes neon-flicker {
            0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% { opacity: 1; }
            20%, 24%, 55% { opacity: 0.5; }
        }

        @keyframes smoke-rise {
            0% { transform: translateY(0) scale(1); opacity: 0.5; }
            100% { transform: translateY(-60px) translateX(15px) scale(2); opacity: 0; }
        }

        @keyframes paper-float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-5px) rotate(1deg); }
        }

        /* =============================================
           SCENE CONTAINER
        ============================================= */
        .scene {
            position: absolute;
            width: 200%;
            height: 100%;
            left: 0;
            top: 0;
            transition: left 0.3s ease-out;
        }

        .scene-layer {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        /* =============================================
           STREET SCENE ELEMENTS
        ============================================= */
        #street-scene {
            background: linear-gradient(to bottom, #080810 0%, #101018 40%, #151520 100%);
        }

        /* Sky */
        .sky {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 45%;
            background: linear-gradient(180deg, #03030a 0%, #080815 60%, #101020 100%);
        }

        .moon {
            position: absolute;
            top: 8%; right: 20%;
            width: 80px; height: 80px;
            background: radial-gradient(circle at 30% 30%, #fff8e8 0%, #e8dcc0 50%, transparent 70%);
            border-radius: 50%;
            box-shadow: 0 0 80px rgba(255,250,220,0.4);
            animation: paper-float 8s ease-in-out infinite;
        }

        /* Buildings - background layer */
        .buildings-far {
            position: absolute;
            bottom: 25%; left: 0;
            width: 100%; height: 55%;
            background: #08080c;
            clip-path: polygon(
                0% 100%, 0% 70%,
                3% 70%, 3% 50%, 8% 50%, 8% 65%,
                12% 65%, 12% 35%, 18% 35%, 18% 55%,
                22% 55%, 22% 40%, 28% 40%, 28% 25%, 32% 25%, 32% 45%,
                38% 45%, 38% 20%, 42% 20%, 42% 15%, 46% 12%, 50% 15%, 50% 20%, 54% 20%, 54% 35%,
                58% 35%, 58% 50%, 64% 50%, 64% 30%, 70% 30%, 70% 45%,
                76% 45%, 76% 35%, 82% 35%, 82% 50%,
                88% 50%, 88% 40%, 94% 40%, 94% 55%,
                100% 55%, 100% 100%
            );
        }

        /* Lit windows in background */
        .bg-window {
            position: absolute;
            background: rgba(255, 220, 150, 0.6);
            box-shadow: 0 0 8px rgba(255, 200, 100, 0.4);
        }

        /* Front buildings */
        .buildings-front {
            position: absolute;
            bottom: 18%; left: 0;
            width: 100%; height: 45%;
        }

        .building {
            position: absolute;
            bottom: 0;
            background: #0c0c12;
        }

        /* Bar building */
        .bar-exterior {
            left: 5%; width: 18%; height: 100%;
            background: linear-gradient(to bottom, #12101a 0%, #0a0810 100%);
        }

        .bar-neon {
            position: absolute;
            top: 10%; left: 50%;
            transform: translateX(-50%);
            font-family: sans-serif;
            font-weight: bold;
            font-size: 20px;
            color: #ff3333;
            text-shadow: 0 0 10px #ff3333, 0 0 20px #ff3333, 0 0 40px #ff0000;
            animation: neon-flicker 3s ease-in-out infinite;
        }

        .bar-door {
            position: absolute;
            bottom: 0; left: 35%;
            width: 30%; height: 55%;
            background: linear-gradient(to bottom, #1a1520 0%, #0a0810 100%);
            border: 3px solid #2a2030;
            cursor: pointer;
        }

        .bar-window-left, .bar-window-right {
            position: absolute;
            width: 18%; height: 25%;
            bottom: 60%;
            background: rgba(200, 100, 80, 0.25);
            border: 2px solid #1a1520;
            box-shadow: inset 0 0 15px rgba(200, 100, 80, 0.3);
        }
        .bar-window-left { left: 8%; }
        .bar-window-right { right: 8%; }

        /* Office building */
        .office-exterior {
            left: 30%; width: 15%; height: 85%;
            background: linear-gradient(to bottom, #141218 0%, #0c0a10 100%);
        }

        .office-sign {
            position: absolute;
            top: 8%; left: 50%;
            transform: translateX(-50%);
            font-size: 7px;
            color: #a89070;
            white-space: nowrap;
            letter-spacing: 1px;
        }

        .office-window {
            position: absolute;
            top: 20%; left: 15%;
            width: 70%; height: 28%;
            background: rgba(255, 230, 180, 0.12);
            border: 3px solid #201a18;
        }

        .office-window::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: repeating-linear-gradient(0deg, transparent 0px, transparent 4px, rgba(0,0,0,0.5) 4px, rgba(0,0,0,0.5) 6px);
        }

        .office-door {
            position: absolute;
            bottom: 0; left: 25%;
            width: 50%; height: 50%;
            background: linear-gradient(to bottom, #1a1515 0%, #080508 100%);
            border: 3px solid #282020;
            cursor: pointer;
        }

        /* Hotel building */
        .hotel-exterior {
            left: 52%; width: 20%; height: 120%;
            background: linear-gradient(to bottom, #101015 0%, #080810 100%);
        }

        .hotel-neon {
            position: absolute;
            top: 5%; left: 50%;
            transform: translateX(-50%);
            font-family: sans-serif;
            font-size: 16px;
            font-weight: bold;
            color: #4488ff;
            text-shadow: 0 0 10px #4488ff, 0 0 20px #4488ff;
            animation: neon-flicker 4s ease-in-out infinite;
            animation-delay: -1.5s;
        }

        .hotel-door {
            position: absolute;
            bottom: 0; left: 30%;
            width: 40%; height: 45%;
            background: linear-gradient(to bottom, #151520 0%, #080810 100%);
            border: 3px solid #252530;
            cursor: pointer;
        }

        /* Diner building */
        .diner-exterior {
            left: 78%; width: 18%; height: 75%;
            background: linear-gradient(to bottom, #181515 0%, #100c0c 100%);
        }

        .diner-neon {
            position: absolute;
            top: 12%; left: 50%;
            transform: translateX(-50%);
            font-family: cursive;
            font-size: 14px;
            color: #ffaa44;
            text-shadow: 0 0 8px #ffaa44, 0 0 16px #ff8822;
            animation: neon-flicker 5s ease-in-out infinite;
            animation-delay: -2s;
        }

        .diner-window {
            position: absolute;
            top: 30%; left: 10%;
            width: 80%; height: 35%;
            background: rgba(255, 200, 120, 0.15);
            border: 2px solid #201815;
        }

        .diner-door {
            position: absolute;
            bottom: 0; left: 35%;
            width: 30%; height: 50%;
            background: #0c0808;
            border: 2px solid #201515;
            cursor: pointer;
        }

        /* Street level */
        .street-ground {
            position: absolute;
            bottom: 0; left: 0;
            width: 100%; height: 20%;
            background: linear-gradient(to bottom, #1a1a1a 0%, #0c0c0c 100%);
        }

        .sidewalk {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 25%;
            background: #222;
        }

        /* Streetlamp */
        .streetlamp {
            position: absolute;
            bottom: 18%;
        }

        .lamp-post {
            width: 6px; height: 140px;
            background: linear-gradient(to right, #151515, #252525, #151515);
            margin: 0 auto;
        }

        .lamp-head {
            width: 35px; height: 25px;
            background: #1a1a1a;
            border-radius: 5px 5px 0 0;
            margin: 0 auto;
        }

        .lamp-glow {
            position: absolute;
            top: -100px; left: 50%;
            transform: translateX(-50%);
            width: 180px; height: 180px;
            background: radial-gradient(circle, rgba(255,240,200,0.2) 0%, transparent 70%);
            animation: neon-flicker 6s ease-in-out infinite;
        }

        /* Parked cars */
        .car {
            position: absolute;
            bottom: 2%;
            cursor: pointer;
            animation: gilliam-idle 5s ease-in-out infinite;
        }

        .car-body {
            width: 140px; height: 45px;
            background: #0a0808;
            clip-path: polygon(0% 100%, 0% 60%, 8% 40%, 25% 25%, 45% 5%, 70% 5%, 88% 25%, 100% 50%, 100% 100%);
        }

        .car-window {
            position: absolute;
            top: 8px; left: 35%;
            width: 35%; height: 35%;
            background: rgba(30, 50, 70, 0.4);
        }

        .car-wheel {
            position: absolute;
            bottom: -5px;
            width: 20px; height: 20px;
            background: #050505;
            border-radius: 50%;
            border: 2px solid #151515;
        }
        .car-wheel.front { right: 12%; }
        .car-wheel.back { left: 10%; }

        .car-1 { left: 8%; }
        .car-2 { left: 55%; }

        /* =============================================
           CHARACTERS
        ============================================= */
        .character {
            position: absolute;
            cursor: pointer;
            transform-origin: bottom center;
            z-index: 50;
            transition: left 0.4s ease-out, bottom 0.4s ease-out;
        }

        .character.walking {
            animation: gilliam-walk 0.4s ease-in-out infinite;
        }

        .character.idle {
            animation: gilliam-idle 4s ease-in-out infinite;
        }

        .character.talking {
            animation: gilliam-talk 0.3s ease-in-out infinite;
        }

        /* Player - Detective */
        #player {
            width: 55px;
            height: 130px;
            z-index: 100;
        }

        .player-shadow {
            position: absolute;
            bottom: -3px; left: 10%;
            width: 80%; height: 8px;
            background: rgba(0,0,0,0.5);
            border-radius: 50%;
            filter: blur(2px);
        }

        .player-body {
            position: absolute;
            bottom: 0; left: 0;
            width: 100%; height: 72%;
            background: #0a0808;
            clip-path: polygon(
                30% 0%, 70% 0%,
                75% 12%, 82% 35%,
                95% 40%, 92% 95%,
                65% 100%, 35% 100%,
                8% 95%, 5% 40%,
                18% 35%, 25% 12%
            );
        }

        .player-head {
            position: absolute;
            bottom: 70%; left: 50%;
            transform: translateX(-50%);
            width: 32px; height: 38px;
        }

        .player-face {
            position: absolute;
            bottom: 0;
            width: 26px; height: 28px;
            background: linear-gradient(to bottom, #d4b896, #c0a080);
            border-radius: 4px 4px 6px 6px;
            margin: 0 auto;
            left: 3px;
        }

        .player-hat {
            position: absolute;
            top: 0; left: 50%;
            transform: translateX(-50%);
            width: 34px; height: 18px;
            background: #151010;
            border-radius: 3px 3px 0 0;
        }

        .player-hat::after {
            content: '';
            position: absolute;
            bottom: -3px; left: -5px;
            width: 44px; height: 5px;
            background: #151010;
        }

        /* NPC - Femme Fatale */
        .npc-femme {
            width: 45px; height: 125px;
        }

        .femme-body {
            position: absolute;
            bottom: 0;
            width: 100%; height: 75%;
            background: linear-gradient(to bottom, #2a1018 0%, #180810 100%);
            clip-path: polygon(
                35% 0%, 65% 0%,
                70% 18%, 72% 45%,
                62% 50%, 72% 100%,
                28% 100%, 38% 50%,
                28% 45%, 30% 18%
            );
        }

        .femme-head {
            position: absolute;
            bottom: 73%; left: 50%;
            transform: translateX(-50%);
            width: 26px; height: 32px;
        }

        .femme-face {
            width: 20px; height: 24px;
            background: linear-gradient(to bottom, #e8d4c0, #d4c0a8);
            border-radius: 3px 3px 5px 5px;
            margin: 8px auto 0;
        }

        .femme-hair {
            position: absolute;
            top: 0; left: 50%;
            transform: translateX(-50%);
            width: 28px; height: 22px;
            background: #1a0a05;
            border-radius: 50% 50% 40% 40%;
        }

        .femme-cigarette {
            position: absolute;
            bottom: 55%; right: -12px;
            width: 18px; height: 3px;
            background: linear-gradient(to right, #f0e8e0, #ff5500);
        }

        .femme-smoke {
            position: absolute;
            bottom: 100%; right: 0;
            width: 6px; height: 6px;
            background: rgba(180,180,180,0.4);
            border-radius: 50%;
            animation: smoke-rise 2.5s ease-out infinite;
        }
        .femme-smoke:nth-child(2) { animation-delay: -0.8s; }
        .femme-smoke:nth-child(3) { animation-delay: -1.6s; }

        /* NPC - Bartender */
        .npc-bartender {
            width: 50px; height: 120px;
        }

        .bartender-body {
            position: absolute;
            bottom: 0;
            width: 100%; height: 70%;
            background: #1a1a1a;
            clip-path: polygon(
                25% 0%, 75% 0%,
                80% 15%, 85% 50%,
                80% 100%, 20% 100%,
                15% 50%, 20% 15%
            );
        }

        .bartender-apron {
            position: absolute;
            bottom: 0;
            left: 20%; width: 60%; height: 45%;
            background: #e8e0d8;
        }

        .bartender-head {
            position: absolute;
            bottom: 68%; left: 50%;
            transform: translateX(-50%);
            width: 28px; height: 32px;
        }

        .bartender-face {
            width: 24px; height: 28px;
            background: linear-gradient(to bottom, #c8a888, #b89878);
            border-radius: 4px 4px 6px 6px;
            margin: 0 auto;
        }

        /* Interaction indicator */
        .interact-indicator {
            position: absolute;
            top: -25px; left: 50%;
            transform: translateX(-50%);
            font-size: 20px;
            color: #c4a35a;
            opacity: 0;
            transition: opacity 0.3s;
            animation: paper-float 1s ease-in-out infinite;
        }

        .character:hover .interact-indicator,
        .hotspot:hover .interact-indicator {
            opacity: 1;
        }

        /* =============================================
           INTERACTIVE OBJECTS (HOTSPOTS)
        ============================================= */
        .hotspot {
            position: absolute;
            cursor: pointer;
            z-index: 30;
        }

        .hotspot:hover {
            filter: brightness(1.3);
        }

        /* Clue items */
        .clue-newspaper {
            bottom: 5%; left: 25%;
            width: 40px; height: 30px;
            background: #d8d0c8;
            transform: rotate(-5deg);
            animation: paper-float 3s ease-in-out infinite;
        }

        .clue-newspaper::before {
            content: '';
            position: absolute;
            top: 5px; left: 5px; right: 5px;
            height: 3px;
            background: #333;
        }

        .clue-matchbook {
            bottom: 6%; left: 70%;
            width: 20px; height: 25px;
            background: linear-gradient(to bottom, #8b0000, #5a0000);
            border-radius: 2px;
        }

        /* Door overlays for interaction */
        .door-hotspot {
            background: transparent;
            border: none;
            z-index: 40;
        }

        .bar-door-hotspot { bottom: 18%; left: 6.75%; width: 5.4%; height: 20%; }
        .office-door-hotspot { bottom: 18%; left: 33.75%; width: 7.5%; height: 18%; }
        .hotel-door-hotspot { bottom: 18%; left: 58%; width: 8%; height: 16%; }
        .diner-door-hotspot { bottom: 18%; left: 83.3%; width: 5.4%; height: 18%; }

        /* =============================================
           INTERIOR SCENES
        ============================================= */
        .interior-scene {
            display: none;
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 200;
        }

        .interior-scene.active {
            display: block;
        }

        /* Bar Interior */
        #bar-interior {
            background: linear-gradient(to bottom, #0f0c12 0%, #080610 100%);
        }

        .bar-back-wall {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 65%;
            background: linear-gradient(to bottom, #1a1520 0%, #12101a 100%);
        }

        .bar-shelves {
            position: absolute;
            top: 15%; left: 10%;
            width: 80%; height: 35%;
            background: #1a1515;
            border: 3px solid #2a2020;
        }

        .bar-bottles {
            position: absolute;
            top: 10%; left: 5%;
            width: 90%; height: 80%;
            background: repeating-linear-gradient(
                90deg,
                rgba(100, 50, 30, 0.3) 0px,
                rgba(100, 50, 30, 0.3) 15px,
                rgba(50, 80, 50, 0.3) 15px,
                rgba(50, 80, 50, 0.3) 30px,
                rgba(80, 60, 40, 0.4) 30px,
                rgba(80, 60, 40, 0.4) 45px
            );
        }

        .bar-counter {
            position: absolute;
            bottom: 25%; left: 5%;
            width: 90%; height: 15%;
            background: linear-gradient(to bottom, #3a2518 0%, #2a1a10 100%);
            border-top: 8px solid #4a3020;
        }

        .bar-stool {
            position: absolute;
            bottom: 15%;
            width: 30px; height: 60px;
        }

        .stool-seat {
            width: 30px; height: 10px;
            background: #2a1a15;
            border-radius: 3px;
        }

        .stool-leg {
            width: 6px; height: 50px;
            background: #1a1a1a;
            margin: 0 auto;
        }

        .bar-floor {
            position: absolute;
            bottom: 0; left: 0;
            width: 100%; height: 18%;
            background: linear-gradient(to bottom, #12100c 0%, #0a0808 100%);
        }

        /* Office Interior */
        #office-interior {
            background: #12100d;
        }

        .office-back-wall {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 70%;
            background: linear-gradient(to bottom, #252018 0%, #1a1510 100%);
        }

        .office-window-int {
            position: absolute;
            top: 10%; right: 15%;
            width: 180px; height: 150px;
            background: linear-gradient(to bottom, #1a2030 0%, #101520 100%);
            border: 6px solid #2a2015;
        }

        .office-blinds {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent 0px, transparent 8px,
                rgba(255,240,200,0.08) 8px, rgba(255,240,200,0.08) 12px
            );
        }

        .office-light-rays {
            position: absolute;
            top: 10%; right: 5%;
            width: 250px; height: 300px;
            background: repeating-linear-gradient(
                -30deg,
                transparent 0px, transparent 12px,
                rgba(255,240,200,0.03) 12px, rgba(255,240,200,0.03) 14px
            );
            transform: skewX(-15deg);
        }

        .office-desk {
            position: absolute;
            bottom: 20%; left: 25%;
            width: 50%; height: 18%;
            background: #3d2a18;
            border-top: 6px solid #4a3520;
        }

        .office-chair {
            position: absolute;
            bottom: 18%; left: 35%;
            width: 60px; height: 100px;
        }

        .chair-back {
            width: 50px; height: 60px;
            background: #2a1a10;
            border-radius: 5px 5px 0 0;
            margin: 0 auto;
        }

        .chair-seat {
            width: 55px; height: 15px;
            background: #2a1a10;
            margin: 0 auto;
        }

        .office-typewriter {
            position: absolute;
            bottom: 35%; left: 45%;
            width: 60px; height: 40px;
            background: #1a1a1a;
            border-radius: 5px 5px 0 0;
            cursor: pointer;
        }

        .office-lamp {
            position: absolute;
            bottom: 35%; left: 30%;
            width: 50px; height: 70px;
        }

        .lamp-shade {
            width: 40px; height: 30px;
            background: #2a4030;
            border-radius: 0 0 20px 20px;
            margin: 0 auto;
        }

        .lamp-stem {
            width: 6px; height: 40px;
            background: #brass;
            background: linear-gradient(to right, #8a7040, #c4a860, #8a7040);
            margin: 0 auto;
        }

        .lamp-glow-int {
            position: absolute;
            top: 0; left: 50%;
            transform: translateX(-50%);
            width: 120px; height: 80px;
            background: radial-gradient(ellipse, rgba(255,240,200,0.15) 0%, transparent 70%);
        }

        .office-filing {
            position: absolute;
            bottom: 15%; left: 8%;
            width: 50px; height: 120px;
            background: #3a3a3a;
            cursor: pointer;
        }

        .filing-drawer {
            width: 100%; height: 30%;
            border-bottom: 2px solid #2a2a2a;
        }

        .office-floor {
            position: absolute;
            bottom: 0; left: 0;
            width: 100%; height: 18%;
            background: linear-gradient(to bottom, #1a1510 0%, #12100c 100%);
        }

        /* Exit button for interiors */
        .exit-btn {
            position: absolute;
            bottom: 20px; left: 20px;
            padding: 12px 25px;
            background: rgba(30, 25, 20, 0.9);
            border: 2px solid #4a3a2a;
            color: #c4a35a;
            font-family: 'Special Elite', monospace;
            font-size: 14px;
            cursor: pointer;
            z-index: 300;
            transition: all 0.2s;
        }

        .exit-btn:hover {
            background: rgba(60, 50, 40, 0.9);
        }

        /* =============================================
           UI ELEMENTS
        ============================================= */
        #ui {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 500;
        }

        #ui > * {
            pointer-events: auto;
        }

        /* Dialogue */
        #dialogue {
            position: absolute;
            bottom: 60px; left: 50%;
            transform: translateX(-50%);
            width: 90%; max-width: 550px;
            background: rgba(12, 10, 8, 0.95);
            border: 3px solid #3d3020;
            padding: 18px;
            display: none;
            box-shadow: 0 8px 40px rgba(0,0,0,0.8);
        }

        #dialogue.visible { display: block; }

        .dialogue-speaker {
            font-family: 'Playfair Display', serif;
            font-size: 13px;
            color: #c4a35a;
            letter-spacing: 3px;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .dialogue-text {
            font-family: 'Special Elite', monospace;
            font-size: 15px;
            color: #d4c5a9;
            line-height: 1.6;
        }

        .dialogue-continue {
            font-size: 10px;
            color: #5a4a3a;
            margin-top: 12px;
            text-align: right;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* Location title */
        #location-title {
            position: absolute;
            top: 25px; left: 50%;
            transform: translateX(-50%);
            font-family: 'Playfair Display', serif;
            font-size: 26px;
            color: #b4a484;
            letter-spacing: 6px;
            text-transform: uppercase;
            text-shadow: 0 2px 15px rgba(0,0,0,0.9);
            opacity: 0;
            transition: opacity 0.8s;
        }

        #location-title.visible { opacity: 1; }

        /* Inventory */
        #inventory {
            position: absolute;
            top: 20px; left: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .inv-item {
            width: 45px; height: 45px;
            background: rgba(25, 20, 15, 0.9);
            border: 2px solid #3a2a1a;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
        }

        .inv-item:hover {
            border-color: #6a5a4a;
            background: rgba(40, 35, 30, 0.9);
        }

        /* Action hint */
        #action-hint {
            position: absolute;
            bottom: 15px; left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: #6a5a4a;
            letter-spacing: 2px;
        }

        /* Film effects */
        #grain {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            opacity: 0.07;
            z-index: 1000;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
        }

        #vignette {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            background: radial-gradient(ellipse at center, transparent 40%, rgba(0,0,0,0.7) 100%);
            z-index: 999;
        }

        /* Title screen */
        #title-screen {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: #080608;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: opacity 1.2s;
        }

        #title-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        #title-screen h1 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(44px, 14vw, 130px);
            color: transparent;
            -webkit-text-stroke: 2px #a88860;
            letter-spacing: 12px;
            margin-bottom: 25px;
            text-shadow: 0 0 60px rgba(180, 140, 100, 0.25);
        }

        #title-screen .tagline {
            font-family: 'Special Elite', monospace;
            font-size: clamp(11px, 3.5vw, 18px);
            color: #4a3a2a;
            letter-spacing: 8px;
            margin-bottom: 50px;
        }

        #title-screen .start-prompt {
            font-family: 'Special Elite', monospace;
            font-size: 13px;
            color: #3a2a1a;
            letter-spacing: 3px;
            animation: pulse 2.2s ease-in-out infinite;
        }

        #title-screen .year {
            position: absolute;
            bottom: 35px;
            font-family: 'Playfair Display', serif;
            font-size: 16px;
            color: #2a1a0a;
            letter-spacing: 4px;
        }
    </style>
</head>
<body>
    <div id="game">
        <!-- STREET SCENE -->
        <div id="street-scene" class="scene">
            <!-- Sky layer -->
            <div class="sky"></div>
            <div class="moon"></div>

            <!-- Background buildings -->
            <div class="buildings-far"></div>
            <div class="bg-window" style="bottom:48%; left:15%; width:4px; height:6px;"></div>
            <div class="bg-window" style="bottom:52%; left:44%; width:5px; height:7px;"></div>
            <div class="bg-window" style="bottom:45%; left:46%; width:4px; height:5px;"></div>
            <div class="bg-window" style="bottom:50%; left:70%; width:4px; height:6px;"></div>

            <!-- Front buildings -->
            <div class="buildings-front">
                <div class="building bar-exterior">
                    <div class="bar-neon">BAR</div>
                    <div class="bar-window-left"></div>
                    <div class="bar-window-right"></div>
                    <div class="bar-door"></div>
                </div>

                <div class="building office-exterior">
                    <div class="office-sign">NOIR INVESTIGATIONS</div>
                    <div class="office-window"></div>
                    <div class="office-door"></div>
                </div>

                <div class="building hotel-exterior">
                    <div class="hotel-neon">HOTEL</div>
                    <div class="hotel-door"></div>
                </div>

                <div class="building diner-exterior">
                    <div class="diner-neon">EATS</div>
                    <div class="diner-window"></div>
                    <div class="diner-door"></div>
                </div>
            </div>

            <!-- Street -->
            <div class="street-ground">
                <div class="sidewalk"></div>
            </div>

            <!-- Streetlamps -->
            <div class="streetlamp" style="left: 26%;">
                <div class="lamp-head"></div>
                <div class="lamp-post"></div>
                <div class="lamp-glow"></div>
            </div>
            <div class="streetlamp" style="left: 65%;">
                <div class="lamp-head"></div>
                <div class="lamp-post"></div>
                <div class="lamp-glow"></div>
            </div>

            <!-- Cars -->
            <div class="car car-1" data-look="car1">
                <div class="car-body"></div>
                <div class="car-window"></div>
                <div class="car-wheel front"></div>
                <div class="car-wheel back"></div>
                <span class="interact-indicator">?</span>
            </div>
            <div class="car car-2" data-look="car2">
                <div class="car-body"></div>
                <div class="car-window"></div>
                <div class="car-wheel front"></div>
                <div class="car-wheel back"></div>
                <span class="interact-indicator">?</span>
            </div>

            <!-- Clue items -->
            <div class="hotspot clue-newspaper" id="clue-newspaper" data-item="newspaper">
                <span class="interact-indicator">!</span>
            </div>
            <div class="hotspot clue-matchbook" id="clue-matchbook" data-item="matchbook">
                <span class="interact-indicator">!</span>
            </div>

            <!-- Door hotspots -->
            <div class="hotspot door-hotspot bar-door-hotspot" data-door="bar"></div>
            <div class="hotspot door-hotspot office-door-hotspot" data-door="office"></div>
            <div class="hotspot door-hotspot hotel-door-hotspot" data-door="hotel"></div>
            <div class="hotspot door-hotspot diner-door-hotspot" data-door="diner"></div>

            <!-- NPCs -->
            <div class="character npc-femme idle" id="npc-vivian" style="left: 40%; bottom: 18%;" data-npc="vivian">
                <div class="femme-head">
                    <div class="femme-hair"></div>
                    <div class="femme-face"></div>
                </div>
                <div class="femme-body"></div>
                <div class="femme-cigarette">
                    <div class="femme-smoke"></div>
                    <div class="femme-smoke"></div>
                    <div class="femme-smoke"></div>
                </div>
                <span class="interact-indicator">?</span>
            </div>

            <!-- Player -->
            <div class="character idle" id="player" style="left: 20%; bottom: 18%;">
                <div class="player-head">
                    <div class="player-hat"></div>
                    <div class="player-face"></div>
                </div>
                <div class="player-body"></div>
                <div class="player-shadow"></div>
            </div>
        </div>

        <!-- BAR INTERIOR -->
        <div id="bar-interior" class="interior-scene">
            <div class="bar-back-wall">
                <div class="bar-shelves">
                    <div class="bar-bottles"></div>
                </div>
            </div>
            <div class="bar-counter"></div>
            <div class="bar-stool" style="left: 20%;"><div class="stool-seat"></div><div class="stool-leg"></div></div>
            <div class="bar-stool" style="left: 35%;"><div class="stool-seat"></div><div class="stool-leg"></div></div>
            <div class="bar-stool" style="left: 50%;"><div class="stool-seat"></div><div class="stool-leg"></div></div>
            <div class="bar-floor"></div>

            <!-- Bartender NPC -->
            <div class="character npc-bartender idle" id="npc-bartender" style="left: 45%; bottom: 38%;" data-npc="bartender">
                <div class="bartender-head">
                    <div class="bartender-face"></div>
                </div>
                <div class="bartender-body">
                    <div class="bartender-apron"></div>
                </div>
                <span class="interact-indicator">?</span>
            </div>

            <!-- Player in bar -->
            <div class="character idle" id="player-bar" style="left: 25%; bottom: 15%;">
                <div class="player-head">
                    <div class="player-hat"></div>
                    <div class="player-face"></div>
                </div>
                <div class="player-body"></div>
                <div class="player-shadow"></div>
            </div>

            <button class="exit-btn" data-exit="street">EXIT</button>
        </div>

        <!-- OFFICE INTERIOR -->
        <div id="office-interior" class="interior-scene">
            <div class="office-back-wall"></div>
            <div class="office-window-int">
                <div class="office-blinds"></div>
            </div>
            <div class="office-light-rays"></div>
            <div class="office-desk"></div>
            <div class="office-chair">
                <div class="chair-back"></div>
                <div class="chair-seat"></div>
            </div>
            <div class="office-lamp">
                <div class="lamp-shade"></div>
                <div class="lamp-stem"></div>
                <div class="lamp-glow-int"></div>
            </div>
            <div class="office-typewriter" data-look="typewriter">
                <span class="interact-indicator">?</span>
            </div>
            <div class="office-filing" data-look="filing">
                <div class="filing-drawer"></div>
                <div class="filing-drawer"></div>
                <div class="filing-drawer"></div>
                <span class="interact-indicator">?</span>
            </div>
            <div class="office-floor"></div>

            <!-- Player in office -->
            <div class="character idle" id="player-office" style="left: 60%; bottom: 15%;">
                <div class="player-head">
                    <div class="player-hat"></div>
                    <div class="player-face"></div>
                </div>
                <div class="player-body"></div>
                <div class="player-shadow"></div>
            </div>

            <button class="exit-btn" data-exit="street">EXIT</button>
        </div>

        <!-- UI Layer -->
        <div id="ui">
            <div id="location-title">MAIN STREET</div>

            <div id="dialogue">
                <div class="dialogue-speaker"></div>
                <div class="dialogue-text"></div>
                <div class="dialogue-continue">tap to continue</div>
            </div>

            <div id="inventory"></div>

            <div id="action-hint">CLICK TO MOVE â€¢ CLICK CHARACTERS TO TALK</div>
        </div>

        <!-- Effects -->
        <div id="vignette"></div>
        <div id="grain"></div>

        <!-- Title -->
        <div id="title-screen">
            <h1>NIGHTFALL</h1>
            <div class="tagline">A COLLAGE NOIR</div>
            <div class="start-prompt">TAP TO BEGIN</div>
            <div class="year">1959</div>
        </div>
    </div>

    <script>
        // ================================================
        // GAME STATE
        // ================================================
        const game = {
            scene: 'street',
            playerX: 20,
            playerY: 18,
            inventory: [],
            flags: {},
            dialogueQueue: [],
            dialogueIndex: 0,
            isMoving: false,
            interactionTarget: null
        };

        // ================================================
        // DIALOGUE DATA
        // ================================================
        const DIALOGUES = {
            vivian_intro: [
                { speaker: "???", text: "You must be the detective. I've heard you're the only one who takes cases the police won't touch." },
                { speaker: "VIVIAN", text: "My name is Vivian Marlowe. My sister Eleanor was found dead at the Avalon Hotel this morning." },
                { speaker: "VIVIAN", text: "Room 214. They're calling it suicide, but Eleanor would never do that. Never." },
                { speaker: "VIVIAN", text: "I need you to find out who really killed her. I'll pay whatever it takes." },
                { speaker: "YOU", text: "I'll look into it. But I need to know everything. Who were her friends? Enemies?" },
                { speaker: "VIVIAN", text: "Start at the Blue Moon bar. She spent her last evening there. Ask for Mickey." }
            ],
            vivian_followup: [
                { speaker: "VIVIAN", text: "Have you found anything yet?" },
                { speaker: "YOU", text: "I'm working on it. These things take time." },
                { speaker: "VIVIAN", text: "Time is something Eleanor doesn't have anymore." }
            ],
            bartender_intro: [
                { speaker: "MICKEY", text: "What can I get ya?" },
                { speaker: "YOU", text: "Information. I'm looking into the Marlowe case." },
                { speaker: "MICKEY", text: "Eleanor? Yeah, she was in here last night. Looked scared. Kept watching the door." },
                { speaker: "MICKEY", text: "She was meeting someone. Big guy in a gray suit. They argued. She left in a hurry." },
                { speaker: "YOU", text: "You get a name?" },
                { speaker: "MICKEY", text: "Didn't catch one. But I saw him before. Works for Castellano." }
            ],
            bartender_followup: [
                { speaker: "MICKEY", text: "Still working that case?" },
                { speaker: "YOU", text: "Castellano. Where do I find him?" },
                { speaker: "MICKEY", text: "You don't find Castellano. He finds you. And that's usually bad news." }
            ],
            car1: [
                { speaker: "NARRATOR", text: "A '57 Chevy. The chrome catches the neon light like blood on a knife." },
                { speaker: "NARRATOR", text: "Someone was in a hurry. The door isn't quite closed." }
            ],
            car2: [
                { speaker: "NARRATOR", text: "Another car. Dented fender. Probably belongs to one of the bar's regulars." }
            ],
            typewriter: [
                { speaker: "NARRATOR", text: "My old Underwood. Still works, mostly. The 'e' key sticks." },
                { speaker: "NARRATOR", text: "Half-finished case reports. Unpaid bills. The usual." }
            ],
            filing: [
                { speaker: "NARRATOR", text: "Case files. Most of them cold. Just like the trails that led nowhere." },
                { speaker: "NARRATOR", text: "Maybe Eleanor Marlowe's file will be different. Maybe." }
            ],
            newspaper: [
                { speaker: "NARRATOR", text: "Today's paper. The headline reads: 'WOMAN FOUND DEAD AT AVALON HOTEL'" },
                { speaker: "NARRATOR", text: "Police are calling it suicide. But since when do they bother investigating those?" }
            ],
            matchbook: [
                { speaker: "NARRATOR", text: "A matchbook from the Blue Moon bar. Someone dropped it here recently." },
                { speaker: "NARRATOR", text: "Might be nothing. Might be everything." }
            ]
        };

        // ================================================
        // DOM REFERENCES
        // ================================================
        const player = document.getElementById('player');
        const streetScene = document.getElementById('street-scene');
        const dialogueBox = document.getElementById('dialogue');
        const locationTitle = document.getElementById('location-title');
        const inventoryEl = document.getElementById('inventory');
        const titleScreen = document.getElementById('title-screen');
        const actionHint = document.getElementById('action-hint');

        // ================================================
        // PLAYER MOVEMENT
        // ================================================
        function movePlayer(targetX, callback) {
            if (game.isMoving) return;

            const currentX = game.playerX;
            const distance = Math.abs(targetX - currentX);

            if (distance < 2) {
                if (callback) callback();
                return;
            }

            game.isMoving = true;
            player.classList.remove('idle');
            player.classList.add('walking');

            // Flip direction
            if (targetX < currentX) {
                player.style.transform = 'scaleX(-1)';
            } else {
                player.style.transform = 'scaleX(1)';
            }

            // Animate movement
            const duration = distance * 30;
            player.style.transition = `left ${duration}ms linear`;
            player.style.left = targetX + '%';
            game.playerX = targetX;

            setTimeout(() => {
                game.isMoving = false;
                player.classList.remove('walking');
                player.classList.add('idle');
                player.style.transition = '';
                if (callback) callback();
            }, duration);
        }

        // ================================================
        // DIALOGUE SYSTEM
        // ================================================
        function startDialogue(key) {
            const dialogue = DIALOGUES[key];
            if (!dialogue) return;

            game.dialogueQueue = dialogue;
            game.dialogueIndex = 0;
            showNextLine();
        }

        function showNextLine() {
            if (game.dialogueIndex >= game.dialogueQueue.length) {
                closeDialogue();
                return;
            }

            const line = game.dialogueQueue[game.dialogueIndex];
            dialogueBox.querySelector('.dialogue-speaker').textContent = line.speaker;
            dialogueBox.querySelector('.dialogue-text').textContent = line.text;
            dialogueBox.classList.add('visible');
        }

        function advanceDialogue() {
            game.dialogueIndex++;
            showNextLine();
        }

        function closeDialogue() {
            dialogueBox.classList.remove('visible');
            game.dialogueQueue = [];
            game.dialogueIndex = 0;

            // Reset NPC animation
            document.querySelectorAll('.character.talking').forEach(el => {
                el.classList.remove('talking');
                el.classList.add('idle');
            });
        }

        // ================================================
        // INTERACTION SYSTEM
        // ================================================
        function interactWithNPC(npcId) {
            const npc = document.getElementById(npcId);
            if (!npc) return;

            npc.classList.remove('idle');
            npc.classList.add('talking');

            const npcType = npc.dataset.npc;

            if (npcType === 'vivian') {
                if (!game.flags.met_vivian) {
                    startDialogue('vivian_intro');
                    game.flags.met_vivian = true;
                } else {
                    startDialogue('vivian_followup');
                }
            } else if (npcType === 'bartender') {
                if (!game.flags.talked_bartender) {
                    startDialogue('bartender_intro');
                    game.flags.talked_bartender = true;
                } else {
                    startDialogue('bartender_followup');
                }
            }
        }

        function lookAtObject(objectId) {
            if (DIALOGUES[objectId]) {
                startDialogue(objectId);
            }
        }

        function collectItem(itemEl, itemId) {
            if (game.inventory.includes(itemId)) return;

            game.inventory.push(itemId);
            itemEl.style.display = 'none';

            // Show item collected
            startDialogue(itemId);

            // Update inventory UI
            updateInventoryUI();
        }

        function updateInventoryUI() {
            inventoryEl.innerHTML = '';
            game.inventory.forEach(item => {
                const div = document.createElement('div');
                div.className = 'inv-item';
                if (item === 'newspaper') div.textContent = 'ðŸ“°';
                if (item === 'matchbook') div.textContent = 'ðŸ”¥';
                inventoryEl.appendChild(div);
            });
        }

        // ================================================
        // SCENE TRANSITIONS
        // ================================================
        function enterLocation(location) {
            const interior = document.getElementById(location + '-interior');
            if (!interior) return;

            streetScene.style.display = 'none';
            interior.classList.add('active');
            game.scene = location;

            showLocationTitle(location === 'bar' ? 'THE BLUE MOON' : 'NOIR INVESTIGATIONS');
        }

        function exitToStreet() {
            document.querySelectorAll('.interior-scene').forEach(el => {
                el.classList.remove('active');
            });
            streetScene.style.display = 'block';
            game.scene = 'street';

            showLocationTitle('MAIN STREET');
        }

        function showLocationTitle(name) {
            locationTitle.textContent = name;
            locationTitle.classList.add('visible');
            setTimeout(() => locationTitle.classList.remove('visible'), 2500);
        }

        // ================================================
        // INPUT HANDLING
        // ================================================
        function setupInputHandlers() {
            // Title screen
            titleScreen.addEventListener('click', startGame);

            // Street scene click to move
            streetScene.addEventListener('click', (e) => {
                if (dialogueBox.classList.contains('visible')) {
                    advanceDialogue();
                    return;
                }

                // Get click position as percentage
                const rect = streetScene.getBoundingClientRect();
                const clickX = ((e.clientX - rect.left) / rect.width) * 100;

                // Clamp to walkable area
                const targetX = Math.max(5, Math.min(90, clickX));
                movePlayer(targetX);
            });

            // NPC interactions
            document.querySelectorAll('[data-npc]').forEach(npc => {
                npc.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (dialogueBox.classList.contains('visible')) {
                        advanceDialogue();
                        return;
                    }

                    const npcX = parseFloat(npc.style.left);
                    movePlayer(npcX - 8, () => {
                        interactWithNPC(npc.id);
                    });
                });
            });

            // Lookable objects
            document.querySelectorAll('[data-look]').forEach(obj => {
                obj.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (dialogueBox.classList.contains('visible')) {
                        advanceDialogue();
                        return;
                    }
                    lookAtObject(obj.dataset.look);
                });
            });

            // Collectible items
            document.querySelectorAll('[data-item]').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (dialogueBox.classList.contains('visible')) {
                        advanceDialogue();
                        return;
                    }

                    const itemX = parseFloat(item.style.left || getComputedStyle(item).left);
                    collectItem(item, item.dataset.item);
                });
            });

            // Door interactions
            document.querySelectorAll('[data-door]').forEach(door => {
                door.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (dialogueBox.classList.contains('visible')) {
                        advanceDialogue();
                        return;
                    }

                    const doorType = door.dataset.door;
                    if (doorType === 'bar' || doorType === 'office') {
                        enterLocation(doorType);
                    } else {
                        startDialogue('locked_door');
                    }
                });
            });

            // Exit buttons
            document.querySelectorAll('[data-exit]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    exitToStreet();
                });
            });

            // Dialogue click
            dialogueBox.addEventListener('click', (e) => {
                e.stopPropagation();
                advanceDialogue();
            });

            // Keyboard
            document.addEventListener('keydown', (e) => {
                if (e.key === ' ' || e.key === 'Enter') {
                    if (dialogueBox.classList.contains('visible')) {
                        advanceDialogue();
                    }
                }
                if (e.key === 'Escape') {
                    closeDialogue();
                }
            });
        }

        // ================================================
        // GAME START
        // ================================================
        function startGame() {
            titleScreen.classList.add('hidden');
            showLocationTitle('MAIN STREET');

            // Brief pause then intro
            setTimeout(() => {
                actionHint.style.display = 'none';
            }, 5000);
        }

        // Initialize
        setupInputHandlers();

        // Add locked door dialogue
        DIALOGUES.locked_door = [
            { speaker: "NARRATOR", text: "Locked. Or maybe just stuck. Either way, it's not opening tonight." }
        ];
    </script>
</body>
</html>
